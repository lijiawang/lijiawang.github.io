<article id="post-kolla-ironic" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 class="article-title" itemprop="name">
      kolla搭建ironic裸机服务
    </h1>
  


  
  
  
  
    
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">2.6k字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">15分</span>
    </span>
  </span>
</div>


  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h3 id="内容说明"><a href="#内容说明" class="headerlink" title="内容说明"></a>内容说明</h3><p>  本文介绍在kolla 管理虚拟机配置流程，包括部署ironic和 裸机管理配置两部分，实现在flat 网络下管理裸机。<br><a id="more"></a></p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>在kolla 环境上增加裸机管理功能。</p>
<p>由于ironic 在管理裸机时需要一个网络来管理裸机的部署和清理。所以需要在部署ironic 前先创建一个flat类型的provision network 网络。本文档业务网络和provision network 网络共用一个。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# source /etc/kolla/admin-openrc.sh</div><div class="line">[root@control01 ~]# openstack network create --provider-physical-network physnet1 \</div><div class="line">    --provider-network-type flat provision-net</div><div class="line">[root@control01 ~]# openstack subnet create --allocation-pool start=172.18.23.1,end=172.18.23.199 \</div><div class="line">    --network provision-net --subnet-range 172.18.23.0.0/24 \</div><div class="line">    --gateway 172.18.151.1 provision-subnet</div></pre></td></tr></table></figure></p>
<h3 id="部署ironic"><a href="#部署ironic" class="headerlink" title="部署ironic"></a>部署ironic</h3><h4 id="修改globals-yml文件"><a href="#修改globals-yml文件" class="headerlink" title="修改globals.yml文件"></a>修改globals.yml文件</h4><p>ironic_cleaning_network 是上面创建的provision network网络ID。 ironic_dnsmasq_dhcp_range 可以随便定义一个，并不会用到，是为了保证ironic_dnsmasq 容器启动正常。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# vim /etc/kolla/globals.yml</div><div class="line">ironic_cleaning_network: "f157770d-e81c-41a3-acf1-8fc3f4ea7f31"</div><div class="line">ironic_dnsmasq_dhcp_range: "172.18.22.210,172.18.22.219"</div><div class="line">enable_horizon_ironic: "&#123;&#123; enable_ironic | bool &#125;&#125;"</div><div class="line">enable_ironic: "yes"</div><div class="line">enable_nova_serialconsole_proxy: "yes"</div></pre></td></tr></table></figure></p>
<h4 id="准备ironic-agent镜像"><a href="#准备ironic-agent镜像" class="headerlink" title="准备ironic-agent镜像"></a>准备ironic-agent镜像</h4><p>ironic-agent 镜像是在联网环境下通过diskimage-builder 生成, 参考官方文档 <a href="https://docs.openstack.org/ironic/latest/install/deploy-ramdisk.html#disk-image-builder" target="_blank" rel="external">disk-image-builder</a>。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# pip install diskimage-builder</div><div class="line">[root@control01 ~]# disk-image-create ironic-agent fedora -o ironic-agent</div></pre></td></tr></table></figure></p>
<p>上传镜像<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# source /etc/kolla/admin-openrc.sh</div><div class="line">[root@control01 ~]# glance image-create --name deploy-vmlinuz \</div><div class="line">    --visibility public  --disk-format aki \</div><div class="line">    --container-format aki --file ./ironic-agent.vmlinuz</div><div class="line">[root@control01 ~]# glance image-create --name deploy-initrd \</div><div class="line">    --visibility public --disk-format ari \</div><div class="line">    --container-format ari --file ./ironic-agent.initramfs</div></pre></td></tr></table></figure></p>
<p>把ironic-agent.initramfs ironic-agent.kernel放到/etc/kolla/config/ironic目录下。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# cd /etc/kolla/config/ironic</div><div class="line">[root@control01 ~]# ls</div><div class="line">ironic-agent.initramfs ironic-agent.kernel</div></pre></td></tr></table></figure></p>
<h4 id="配置ironic-conf"><a href="#配置ironic-conf" class="headerlink" title="配置ironic.conf"></a>配置ironic.conf</h4><p>配置drivers 为支持远程console 的pxe_ipmitool_socat<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# cat /etc/kolla/config/ironic.conf</div><div class="line">[DEFAULT]</div><div class="line">enabled_drivers = pxe_ipmitool_socat,pxe_ipmitool</div><div class="line">enabled_hardware_types = ipmi</div><div class="line">enabled_network_interfaces=noop,flat</div><div class="line">enabled_power_interfaces = ipmitool</div><div class="line">enabled_management_interfaces = ipmitool</div><div class="line"></div><div class="line">[neutron]</div><div class="line"><span class="meta">#</span><span class="bash">After deploy the OpenStack, Update the cleaning_network</span></div><div class="line"><span class="meta">#</span><span class="bash">cleaning_network = externel</span></div><div class="line"></div><div class="line">[conductor]</div><div class="line">sync_power_state_interval = 10</div><div class="line">power_state_sync_max_retries = 20</div><div class="line"><span class="meta">#</span><span class="bash">power_state_change_timeout = 30</span></div><div class="line">deploy_callback_timeout = 900</div><div class="line">force_power_state_during_sync = true</div><div class="line"></div><div class="line">[pxe]</div><div class="line"><span class="meta">#</span><span class="bash">uefi_pxe_bootfile_name = bootx64.efi</span></div><div class="line"><span class="meta">#</span><span class="bash">After deploy the OpenStack, Update the tftp_server</span></div><div class="line"><span class="meta">#</span><span class="bash">tftp_server =</span></div><div class="line"><span class="meta">#</span><span class="bash">pxe_append_params = coreos.autologin rd.auto=1 nofb nomodeset vga=normal console=ttyS0,115200n8</span></div><div class="line">pxe_append_params = nofb nomodeset vga=normal console=tty0 console=ttyS0,115200n8</div><div class="line"></div><div class="line">[disk_utils]</div><div class="line"><span class="meta">#</span><span class="bash">default interval is 1 second</span></div><div class="line">iscsi_verify_attempts = 30</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> cat /etc/kolla/config/ironic.conf</span></div><div class="line"></div><div class="line">[DEFAULT]</div><div class="line">enabled_drivers = pxe_ipmitool_socat</div><div class="line">enabled_network_interfaces=noop,flat</div><div class="line"></div><div class="line">[pxe]</div><div class="line">pxe_append_params = nofb nomodeset vga=normal console=tty0 console=ttyS0,115200n8</div></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">cat /etc/kolla/config/ironic.conf</div><div class="line">[DEFAULT]</div><div class="line">enabled_drivers = pxe_ipmitool_socat</div><div class="line">enabled_hardware_types = redfish</div><div class="line">enabled_power_interfaces = ipmitool,redfish</div><div class="line">enabled_management_interfaces = ipmitool,redfish</div><div class="line">default_network_interface = flat</div><div class="line"></div><div class="line">[neutron]</div><div class="line"><span class="meta">#</span><span class="bash">After deploy the OpenStack, Update the cleaning_network</span></div><div class="line"><span class="meta">#</span><span class="bash">cleaning_network = externel</span></div><div class="line"></div><div class="line">[conductor]</div><div class="line">sync_power_state_interval = 10</div><div class="line">power_state_sync_max_retries = 20</div><div class="line"><span class="meta">#</span><span class="bash">power_state_change_timeout = 30</span></div><div class="line">deploy_callback_timeout = 900</div><div class="line">force_power_state_during_sync = true</div><div class="line"></div><div class="line">[pxe]</div><div class="line">pxe_append_params = coreos.autologin rd.auto=1 nofb nomodeset vga=normal console=ttyS0,115200n8</div><div class="line"></div><div class="line">[disk_utils]</div><div class="line"><span class="meta">#</span><span class="bash">default interval is 1 second</span></div><div class="line">iscsi_verify_attempts = 30</div></pre></td></tr></table></figure></p>
<h3 id="检查部署"><a href="#检查部署" class="headerlink" title="检查部署"></a>检查部署</h3><h4 id="部署检查"><a href="#部署检查" class="headerlink" title="部署检查"></a>部署检查</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# kolla-ansible -i multinode prechecks</div></pre></td></tr></table></figure>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# kolla-ansible -i multinode deploy</div></pre></td></tr></table></figure>
<h4 id="部署后检查"><a href="#部署后检查" class="headerlink" title="部署后检查"></a>部署后检查</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ironic driver-list</div><div class="line">+---------------------+---------------------------------+</div><div class="line">| Supported driver(s) | Active host(s)                  |</div><div class="line">+---------------------+---------------------------------+</div><div class="line">| ipmi                | control02, control03, control01 |</div><div class="line">| pxe_ipmitool        | control02, control03, control01 |</div><div class="line">| pxe_ipmitool_socat  | control02, control03, control01 |</div><div class="line">+---------------------+---------------------------------+</div><div class="line">[root@control01 ~]# nova service-list</div><div class="line">+-----+------------------+------------------+----------+---------+-------+----------------------------+-----------------+</div><div class="line">| Id  | Binary           | Host             | Zone     | Status  | State | Updated_at                 | Disabled Reason |</div><div class="line">+-----+------------------+------------------+----------+---------+-------+----------------------------+-----------------+</div><div class="line">| 4   | nova-scheduler   | control02        | internal | enabled | up    | 2017-08-31T01:48:41.000000 | -               |</div><div class="line">| 10  | nova-scheduler   | control01        | internal | enabled | up    | 2017-08-31T01:48:37.000000 | -               |</div><div class="line">| 22  | nova-conductor   | control02        | internal | enabled | up    | 2017-08-31T01:48:40.000000 | -               |</div><div class="line">| 31  | nova-conductor   | control01        | internal | enabled | up    | 2017-08-31T01:48:39.000000 | -               |</div><div class="line">| 61  | nova-consoleauth | control02        | internal | enabled | up    | 2017-08-31T01:48:36.000000 | -               |</div><div class="line">| 64  | nova-consoleauth | control01        | internal | enabled | up    | 2017-08-31T01:48:42.000000 | -               |</div><div class="line">| 67  | nova-compute     | control02        | nova     | enabled | up    | 2017-08-31T01:48:40.000000 | -               |</div><div class="line">| 70  | nova-compute     | control01        | nova     | enabled | up    | 2017-08-31T01:48:36.000000 | -               |</div><div class="line">| 76  | nova-scheduler   | control03        | internal | enabled | up    | 2017-08-31T01:48:42.000000 | -               |</div><div class="line">| 82  | nova-conductor   | control03        | internal | enabled | up    | 2017-08-31T01:48:36.000000 | -               |</div><div class="line">| 91  | nova-consoleauth | control03        | internal | enabled | up    | 2017-08-31T01:48:43.000000 | -               |</div><div class="line">| 94  | nova-compute     | control03        | nova     | enabled | up    | 2017-08-31T01:48:44.000000 | -               |</div><div class="line">| 97  | nova-compute     | control03-ironic | nova     | enabled | up    | 2017-08-31T01:48:44.000000 | -               |</div><div class="line">| 100 | nova-compute     | control02-ironic | nova     | enabled | up    | 2017-08-31T01:48:42.000000 | -               |</div><div class="line">| 103 | nova-compute     | control01-ironic | nova     | enabled | up    | 2017-08-31T01:48:43.000000 | -               |</div><div class="line">+-----+------------------+------------------+----------+---------+-------+----------------------------+-----------------+</div></pre></td></tr></table></figure>
<h3 id="使用ironic-管理物理服务器"><a href="#使用ironic-管理物理服务器" class="headerlink" title="使用ironic 管理物理服务器"></a>使用ironic 管理物理服务器</h3><p>每一台需要管理的裸机，都要创建为一个ironic node ，包括ipmi、服务器配置等信息。 再为ironic node 配置管理网卡的信息。</p>
<h4 id="创建ironic-node"><a href="#创建ironic-node" class="headerlink" title="创建ironic node"></a>创建ironic node</h4><p>创建ironic node,配置网络接口为flat<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# export IRONIC_API_VERSION=1.20</div><div class="line">[root@control01 ~]# ironic node-create -d pxe_ipmitool_socat --network-interface flat -n node1</div><div class="line">+-------------------+--------------------------------------+</div><div class="line">| Property          | Value                                |</div><div class="line">+-------------------+--------------------------------------+</div><div class="line">| chassis_uuid      | None                                 |</div><div class="line">| driver            | pxe_ipmitool_socat                   |</div><div class="line">| driver_info       | &#123;&#125;                                   |</div><div class="line">| extra             | &#123;&#125;                                   |</div><div class="line">| name              | node1                                |</div><div class="line">| network_interface | flat                                 |</div><div class="line">| properties        | &#123;&#125;                                   |</div><div class="line">| resource_class    |                                      |</div><div class="line">| uuid              | c78f0257-bfbf-489c-b525-a39e0b924b79 |</div><div class="line">+-------------------+--------------------------------------+</div></pre></td></tr></table></figure></p>
<h4 id="配置ironic-node-信息"><a href="#配置ironic-node-信息" class="headerlink" title="配置ironic node 信息"></a>配置ironic node 信息</h4><h5 id="配置ipmi信息"><a href="#配置ipmi信息" class="headerlink" title="配置ipmi信息"></a>配置ipmi信息</h5><p>ipmi_username,ipmi_password,ipmi_address 为裸机ipmi信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# NODE_UUID=$(ironic node-list|grep node1|awk -F "| " '&#123;print $2&#125;')</div><div class="line">[root@control01 ~]#  ironic node-update $NODE_UUID add     driver_info/ipmi_username=admin   \</div><div class="line"><span class="meta">&gt;</span><span class="bash">    driver_info/ipmi_password=admin     driver_info/ipmi_address=172.18.21.164 \</span></div><div class="line"><span class="meta">&gt;</span><span class="bash">    driver_info/ipmi_terminal_port=8901</span></div><div class="line">+------------------------+------------------------------------------------------------------+</div><div class="line">| Property               | Value                                                            |</div><div class="line">+------------------------+------------------------------------------------------------------+</div><div class="line">| chassis_uuid           | None                                                             |</div><div class="line">| clean_step             | &#123;&#125;                                                               |</div><div class="line">| console_enabled        | False                                                            |</div><div class="line">| created_at             | 2017-08-31T01:50:09+00:00                                        |</div><div class="line">| driver                 | pxe_ipmitool_socat                                               |</div><div class="line">| driver_info            | &#123;u'ipmi_terminal_port': 8901, u'ipmi_address': u'172.18.21.164', |</div><div class="line">|                        | u'ipmi_username': u'admin', u'ipmi_password': u'******'&#125;         |</div><div class="line">| driver_internal_info   | &#123;&#125;                                                               |</div><div class="line">| extra                  | &#123;&#125;                                                               |</div><div class="line">| inspection_finished_at | None                                                             |</div><div class="line">| inspection_started_at  | None                                                             |</div><div class="line">| instance_info          | &#123;&#125;                                                               |</div><div class="line">| instance_uuid          | None                                                             |</div><div class="line">| last_error             | None                                                             |</div><div class="line">| maintenance            | False                                                            |</div><div class="line">| maintenance_reason     | None                                                             |</div><div class="line">| name                   | node1                                                            |</div><div class="line">| network_interface      | flat                                                             |</div><div class="line">| power_state            | None                                                             |</div><div class="line">| properties             | &#123;&#125;                                                               |</div><div class="line">| provision_state        | enroll                                                           |</div><div class="line">| provision_updated_at   | None                                                             |</div><div class="line">| raid_config            | &#123;&#125;                                                               |</div><div class="line">| reservation            | control02                                                        |</div><div class="line">| resource_class         |                                                                  |</div><div class="line">| target_power_state     | None                                                             |</div><div class="line">| target_provision_state | None                                                             |</div><div class="line">| target_raid_config     | &#123;&#125;                                                               |</div><div class="line">| updated_at             | 2017-08-31T01:51:40+00:00                                        |</div><div class="line">| uuid                   | c78f0257-bfbf-489c-b525-a39e0b924b79                             |</div><div class="line">+------------------------+------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h4 id="配置ramdisk-kernel信息"><a href="#配置ramdisk-kernel信息" class="headerlink" title="配置ramdisk ,kernel信息"></a>配置ramdisk ,kernel信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# DEPLOY_VMLINUZ_UUID=$(glance image-list|grep deploy-vmlinuz|awk -F "| " '&#123;print $2&#125;')</div><div class="line">[root@control01 ~]# DEPLOY_INITRD_UUID=$(glance image-list|grep deploy-initrd|awk -F "| " '&#123;print $2&#125;')</div><div class="line">[root@control01 ~]# ironic node-update $NODE_UUID add     driver_info/deploy_kernel=$DEPLOY_VMLINUZ_UUID \</div><div class="line"><span class="meta">&gt;</span><span class="bash">     driver_info/deploy_ramdisk=<span class="variable">$DEPLOY_INITRD_UUID</span></span></div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| Property               | Value                                                                 |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| chassis_uuid           | None                                                                  |</div><div class="line">| clean_step             | &#123;&#125;                                                                    |</div><div class="line">| console_enabled        | False                                                                 |</div><div class="line">| created_at             | 2017-08-31T01:50:09+00:00                                             |</div><div class="line">| driver                 | pxe_ipmitool_socat                                                    |</div><div class="line">| driver_info            | &#123;u'ipmi_terminal_port': 8901, u'ipmi_username': u'admin',             |</div><div class="line">|                        | u'deploy_kernel': u'99a5c143-e231-4018-a6bf-121585eb6290',            |</div><div class="line">|                        | u'ipmi_address': u'172.18.21.164', u'deploy_ramdisk':                 |</div><div class="line">|                        | u'8c23e3e4-e749-4a91-9af7-63674b5f5128', u'ipmi_password': u'******'&#125; |</div><div class="line">| driver_internal_info   | &#123;&#125;                                                                    |</div><div class="line">| extra                  | &#123;&#125;                                                                    |</div><div class="line">| inspection_finished_at | None                                                                  |</div><div class="line">| inspection_started_at  | None                                                                  |</div><div class="line">| instance_info          | &#123;&#125;                                                                    |</div><div class="line">| instance_uuid          | None                                                                  |</div><div class="line">| last_error             | None                                                                  |</div><div class="line">| maintenance            | False                                                                 |</div><div class="line">| maintenance_reason     | None                                                                  |</div><div class="line">| name                   | node1                                                                 |</div><div class="line">| network_interface      | flat                                                                  |</div><div class="line">| power_state            | None                                                                  |</div><div class="line">| properties             | &#123;&#125;                                                                    |</div><div class="line">| provision_state        | enroll                                                                |</div><div class="line">| provision_updated_at   | None                                                                  |</div><div class="line">| raid_config            | &#123;&#125;                                                                    |</div><div class="line">| reservation            | control02                                                             |</div><div class="line">| resource_class         |                                                                       |</div><div class="line">| target_power_state     | None                                                                  |</div><div class="line">| target_provision_state | None                                                                  |</div><div class="line">| target_raid_config     | &#123;&#125;                                                                    |</div><div class="line">| updated_at             | 2017-08-31T01:52:16+00:00                                             |</div><div class="line">| uuid                   | c78f0257-bfbf-489c-b525-a39e0b924b79                                  |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h5 id="配置服务器硬件信息"><a href="#配置服务器硬件信息" class="headerlink" title="配置服务器硬件信息"></a>配置服务器硬件信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ironic node-update $NODE_UUID add  properties/cpus=36  properties/memory_mb=129024 \</div><div class="line"><span class="meta">&gt;</span><span class="bash">     properties/local_gb=120     properties/cpu_arch=x86_64</span></div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| Property               | Value                                                                 |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| chassis_uuid           | None                                                                  |</div><div class="line">| clean_step             | &#123;&#125;                                                                    |</div><div class="line">| console_enabled        | False                                                                 |</div><div class="line">| created_at             | 2017-08-31T01:50:09+00:00                                             |</div><div class="line">| driver                 | pxe_ipmitool_socat                                                    |</div><div class="line">| driver_info            | &#123;u'ipmi_terminal_port': 8901, u'ipmi_username': u'admin',             |</div><div class="line">|                        | u'deploy_kernel': u'99a5c143-e231-4018-a6bf-121585eb6290',            |</div><div class="line">|                        | u'ipmi_address': u'172.18.21.164', u'deploy_ramdisk':                 |</div><div class="line">|                        | u'8c23e3e4-e749-4a91-9af7-63674b5f5128', u'ipmi_password': u'******'&#125; |</div><div class="line">| driver_internal_info   | &#123;&#125;                                                                    |</div><div class="line">| extra                  | &#123;&#125;                                                                    |</div><div class="line">| inspection_finished_at | None                                                                  |</div><div class="line">| inspection_started_at  | None                                                                  |</div><div class="line">| instance_info          | &#123;&#125;                                                                    |</div><div class="line">| instance_uuid          | None                                                                  |</div><div class="line">| last_error             | None                                                                  |</div><div class="line">| maintenance            | False                                                                 |</div><div class="line">| maintenance_reason     | None                                                                  |</div><div class="line">| name                   | node1                                                                 |</div><div class="line">| network_interface      | flat                                                                  |</div><div class="line">| power_state            | None                                                                  |</div><div class="line">| properties             | &#123;u'memory_mb': 129024, u'cpu_arch': u'x86_64', u'local_gb': 120,      |</div><div class="line">|                        | u'cpus': 36&#125;                                                          |</div><div class="line">| provision_state        | enroll                                                                |</div><div class="line">| provision_updated_at   | None                                                                  |</div><div class="line">| raid_config            | &#123;&#125;                                                                    |</div><div class="line">| reservation            | control02                                                             |</div><div class="line">| resource_class         |                                                                       |</div><div class="line">| target_power_state     | None                                                                  |</div><div class="line">| target_provision_state | None                                                                  |</div><div class="line">| target_raid_config     | &#123;&#125;                                                                    |</div><div class="line">| updated_at             | 2017-08-31T01:52:28+00:00                                             |</div><div class="line">| uuid                   | c78f0257-bfbf-489c-b525-a39e0b924b79                                  |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h5 id="开启控制台"><a href="#开启控制台" class="headerlink" title="开启控制台"></a>开启控制台</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]#  ironic node-set-console-mode $NODE_UUID true</div></pre></td></tr></table></figure>
<h4 id="创建ironic-port"><a href="#创建ironic-port" class="headerlink" title="创建ironic port"></a>创建ironic port</h4><p>MAC_ADDRESS 为裸机业务网络网卡MAC地址, 可以登录裸机IPMI查询。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# MAC_ADDRESS=08:9E:01:FC:48:7D</div><div class="line">[root@control01 ~]#  ironic port-create -n $NODE_UUID -a $MAC_ADDRESS</div><div class="line">+-----------------------+--------------------------------------+</div><div class="line">| Property              | Value                                |</div><div class="line">+-----------------------+--------------------------------------+</div><div class="line">| address               | 08:9e:01:fc:48:7d                    |</div><div class="line">| extra                 | &#123;&#125;                                   |</div><div class="line">| local_link_connection | &#123;&#125;                                   |</div><div class="line">| node_uuid             | c78f0257-bfbf-489c-b525-a39e0b924b79 |</div><div class="line">| portgroup_uuid        |                                      |</div><div class="line">| pxe_enabled           | True                                 |</div><div class="line">| uuid                  | 40158d94-76c2-4893-b081-075729ea210f |</div><div class="line">+-----------------------+--------------------------------------+</div></pre></td></tr></table></figure></p>
<h5 id="检查ironic-node"><a href="#检查ironic-node" class="headerlink" title="检查ironic node"></a>检查ironic node</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ironic node-list</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| UUID                                 | Name  | Instance UUID | Power State | Provisioning State | Maintenance |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| c78f0257-bfbf-489c-b525-a39e0b924b79 | node1 | None          | None        | enroll             | False       |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">[root@control01 ~]# ironic node-show c78f0257-bfbf-489c-b525-a39e0b924b79</div><div class="line">+------------------------+--------------------------------------------------------------------------+</div><div class="line">| Property               | Value                                                                    |</div><div class="line">+------------------------+--------------------------------------------------------------------------+</div><div class="line">| chassis_uuid           | None                                                                     |</div><div class="line">| clean_step             | &#123;&#125;                                                                       |</div><div class="line">| console_enabled        | False                                                                    |</div><div class="line">| created_at             | 2017-08-31T01:50:09+00:00                                                |</div><div class="line">| driver                 | pxe_ipmitool_socat                                                       |</div><div class="line">| driver_info            | &#123;u'ipmi_terminal_port': 8901, u'ipmi_username': u'admin',                |</div><div class="line">|                        | u'deploy_kernel': u'99a5c143-e231-4018-a6bf-121585eb6290',               |</div><div class="line">|                        | u'ipmi_address': u'172.18.21.164', u'deploy_ramdisk':                    |</div><div class="line">|                        | u'8c23e3e4-e749-4a91-9af7-63674b5f5128', u'ipmi_password': u'******'&#125;    |</div><div class="line">| driver_internal_info   | &#123;&#125;                                                                       |</div><div class="line">| extra                  | &#123;&#125;                                                                       |</div><div class="line">| inspection_finished_at | None                                                                     |</div><div class="line">| inspection_started_at  | None                                                                     |</div><div class="line">| instance_info          | &#123;&#125;                                                                       |</div><div class="line">| instance_uuid          | None                                                                     |</div><div class="line">| last_error             | Error enabling the console on node c78f0257-bfbf-489c-b525-a39e0b924b79. |</div><div class="line">|                        | Reason: Console subprocess failed to start. Command: socat -T600         |</div><div class="line">|                        | -L/tmp/c78f0257-bfbf-489c-b525-a39e0b924b79.pid                          |</div><div class="line">|                        | TCP4-LISTEN:8901,bind=172.18.22.161,reuseaddr EXEC:"ipmitool -H          |</div><div class="line">|                        | 172.18.21.164 -I lanplus -U admin -f /tmp/c78f0257-bfbf-                 |</div><div class="line">|                        | 489c-b525-a39e0b924b79.pw -v sol activate",pty,stderr. Exit code: 1.     |</div><div class="line">|                        | Stderr: '2017/08/31 09:52:42 socat[39] E bind(11, &#123;AF=2                  |</div><div class="line">|                        | 172.18.22.161:8901&#125;, 16): Address already in use                         |</div><div class="line">|                        | '                                                                        |</div><div class="line">| maintenance            | False                                                                    |</div><div class="line">| maintenance_reason     | None                                                                     |</div><div class="line">| name                   | node1                                                                    |</div><div class="line">| network_interface      | flat                                                                     |</div><div class="line">| power_state            | None                                                                     |</div><div class="line">| properties             | &#123;u'memory_mb': 129024, u'cpu_arch': u'x86_64', u'local_gb': 120,         |</div><div class="line">|                        | u'cpus': 36&#125;                                                             |</div><div class="line">| provision_state        | enroll                                                                   |</div><div class="line">| provision_updated_at   | None                                                                     |</div><div class="line">| raid_config            | &#123;&#125;                                                                       |</div><div class="line">| reservation            | None                                                                     |</div><div class="line">| resource_class         |                                                                          |</div><div class="line">| target_power_state     | None                                                                     |</div><div class="line">| target_provision_state | None                                                                     |</div><div class="line">| target_raid_config     | &#123;&#125;                                                                       |</div><div class="line">| updated_at             | 2017-08-31T01:53:01+00:00                                                |</div><div class="line">| uuid                   | c78f0257-bfbf-489c-b525-a39e0b924b79                                     |</div><div class="line">+------------------------+--------------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h5 id="修改状态将enroll改为available"><a href="#修改状态将enroll改为available" class="headerlink" title="修改状态将enroll改为available"></a>修改状态将enroll改为available</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ironic --ironic-api-version 1.20 node-set-provision-state $NODE_UUID manage</div><div class="line">[root@control01 ~]# ironic node-list</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| UUID                                 | Name  | Instance UUID | Power State | Provisioning State | Maintenance |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| c78f0257-bfbf-489c-b525-a39e0b924b79 | node1 | None          | power off   | manageable         | False       |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">[root@control01 ~]# ironic --ironic-api-version 1.20 node-set-provision-state $NODE_UUID provide</div><div class="line">[root@control01 ~]# ironic node-list</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| UUID                                 | Name  | Instance UUID | Power State | Provisioning State | Maintenance |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div><div class="line">| c78f0257-bfbf-489c-b525-a39e0b924b79 | node1 | None          | power off   | available          | False       |</div><div class="line">+--------------------------------------+-------+---------------+-------------+--------------------+-------------+</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ironic node-show c78f0257-bfbf-489c-b525-a39e0b924b79</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| Property               | Value                                                                 |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div><div class="line">| chassis_uuid           | None                                                                  |</div><div class="line">| clean_step             | &#123;&#125;                                                                    |</div><div class="line">| console_enabled        | False                                                                 |</div><div class="line">| created_at             | 2017-08-31T01:50:09+00:00                                             |</div><div class="line">| driver                 | pxe_ipmitool_socat                                                    |</div><div class="line">| driver_info            | &#123;u'ipmi_terminal_port': 8901, u'ipmi_username': u'admin',             |</div><div class="line">|                        | u'deploy_kernel': u'99a5c143-e231-4018-a6bf-121585eb6290',            |</div><div class="line">|                        | u'ipmi_address': u'172.18.21.164', u'deploy_ramdisk':                 |</div><div class="line">|                        | u'8c23e3e4-e749-4a91-9af7-63674b5f5128', u'ipmi_password': u'******'&#125; |</div><div class="line">| driver_internal_info   | &#123;&#125;                                                                    |</div><div class="line">| extra                  | &#123;&#125;                                                                    |</div><div class="line">| inspection_finished_at | None                                                                  |</div><div class="line">| inspection_started_at  | None                                                                  |</div><div class="line">| instance_info          | &#123;&#125;                                                                    |</div><div class="line">| instance_uuid          | None                                                                  |</div><div class="line">| last_error             | None                                                                  |</div><div class="line">| maintenance            | False                                                                 |</div><div class="line">| maintenance_reason     | None                                                                  |</div><div class="line">| name                   | node1                                                                 |</div><div class="line">| network_interface      | flat                                                                  |</div><div class="line">| power_state            | power off                                                             |</div><div class="line">| properties             | &#123;u'memory_mb': 129024, u'cpu_arch': u'x86_64', u'local_gb': 120,      |</div><div class="line">|                        | u'cpus': 36&#125;                                                          |</div><div class="line">| provision_state        | available                                                             |</div><div class="line">| provision_updated_at   | 2017-08-31T01:56:55+00:00                                             |</div><div class="line">| raid_config            | &#123;&#125;                                                                    |</div><div class="line">| reservation            | None                                                                  |</div><div class="line">| resource_class         |                                                                       |</div><div class="line">| target_power_state     | None                                                                  |</div><div class="line">| target_provision_state | None                                                                  |</div><div class="line">| target_raid_config     | &#123;&#125;                                                                    |</div><div class="line">| updated_at             | 2017-08-31T01:56:55+00:00                                             |</div><div class="line">| uuid                   | c78f0257-bfbf-489c-b525-a39e0b924b79                                  |</div><div class="line">+------------------------+-----------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<h5 id="检查nova-hypervisor"><a href="#检查nova-hypervisor" class="headerlink" title="检查nova hypervisor"></a>检查nova hypervisor</h5><p>ironic node 添加完成后会新增一个nova hypervisor，通过nova hypervisor-show 可以看到裸机的vcpu,memory,disk 等配置信息。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# nova hypervisor-list</div><div class="line">+----+--------------------------------------+-------+---------+</div><div class="line">| ID | Hypervisor hostname                  | State | Status  |</div><div class="line">+----+--------------------------------------+-------+---------+</div><div class="line">| 4  | control02                            | up    | enabled |</div><div class="line">| 7  | control01                            | up    | enabled |</div><div class="line">| 10 | control03                            | up    | enabled |</div><div class="line">| 58 | c78f0257-bfbf-489c-b525-a39e0b924b79 | up    | enabled |</div><div class="line">+----+--------------------------------------+-------+---------+</div><div class="line">[root@control01 ~]# nova hypervisor-show 58</div><div class="line">+-------------------------+--------------------------------------+</div><div class="line">| Property                | Value                                |</div><div class="line">+-------------------------+--------------------------------------+</div><div class="line">| cpu_info                | &#123;&#125;                                   |</div><div class="line">| current_workload        | 0                                    |</div><div class="line">| disk_available_least    | 120                                  |</div><div class="line">| free_disk_gb            | 120                                  |</div><div class="line">| free_ram_mb             | 129024                               |</div><div class="line">| host_ip                 | 172.18.22.162                        |</div><div class="line">| hypervisor_hostname     | c78f0257-bfbf-489c-b525-a39e0b924b79 |</div><div class="line">| hypervisor_type         | ironic                               |</div><div class="line">| hypervisor_version      | 1                                    |</div><div class="line">| id                      | 58                                   |</div><div class="line">| local_gb                | 120                                  |</div><div class="line">| local_gb_used           | 0                                    |</div><div class="line">| memory_mb               | 129024                               |</div><div class="line">| memory_mb_used          | 0                                    |</div><div class="line">| running_vms             | 0                                    |</div><div class="line">| service_disabled_reason | None                                 |</div><div class="line">| service_host            | control01-ironic                     |</div><div class="line">| service_id              | 103                                  |</div><div class="line">| state                   | up                                   |</div><div class="line">| status                  | enabled                              |</div><div class="line">| vcpus                   | 36                                   |</div><div class="line">| vcpus_used              | 0                                    |</div><div class="line">+-------------------------+--------------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="创建裸机"><a href="#创建裸机" class="headerlink" title="创建裸机"></a>创建裸机</h3><p>由于目前horizon ironic 部分功能尚未完成，这里先以命令行形式创建虚拟机。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# openstack server create --image 442f0935-33cc-450b-b641-9f438fdcb7ea --flavor 2327b74a-88b4-49f6-a0cd-9a06c13c801a --key-name mykey \</div><div class="line"><span class="meta">&gt;</span><span class="bash">     --nic net-id=f157770d<span class="_">-e</span>81c-41a3-acf1-8<span class="built_in">fc</span>3f4ea7f31 \</span></div><div class="line"><span class="meta">&gt;</span><span class="bash">     --availability-zone nova:control01-ironic <span class="built_in">test</span></span></div><div class="line">+-------------------------------------+------------------------------------------------+</div><div class="line">| Field                               | Value                                          |</div><div class="line">+-------------------------------------+------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | nova                                           |</div><div class="line">| OS-EXT-SRV-ATTR:host                | None                                           |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                           |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       |                                                |</div><div class="line">| OS-EXT-STS:power_state              | NOSTATE                                        |</div><div class="line">| OS-EXT-STS:task_state               | scheduling                                     |</div><div class="line">| OS-EXT-STS:vm_state                 | building                                       |</div><div class="line">| OS-SRV-USG:launched_at              | None                                           |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                           |</div><div class="line">| accessIPv4                          |                                                |</div><div class="line">| accessIPv6                          |                                                |</div><div class="line">| addresses                           |                                                |</div><div class="line">| adminPass                           | YQS2x3r3AyYJ                                   |</div><div class="line">| config_drive                        |                                                |</div><div class="line">| created                             | 2017-08-31T02:01:31Z                           |</div><div class="line">| flavor                              | ironic (2327b74a-88b4-49f6-a0cd-9a06c13c801a)  |</div><div class="line">| hostId                              |                                                |</div><div class="line">| id                                  | 54142f88-8170-4081-a2c0-b8da831a7dd1           |</div><div class="line">| image                               | centos7 (442f0935-33cc-450b-b641-9f438fdcb7ea) |</div><div class="line">| key_name                            | mykey                                          |</div><div class="line">| name                                | test                                           |</div><div class="line">| progress                            | 0                                              |</div><div class="line">| project_id                          | 1345d1d9ddf34ee887fd1c17a4bb02b6               |</div><div class="line">| properties                          |                                                |</div><div class="line">| security_groups                     | name='default'                                 |</div><div class="line">| status                              | BUILD                                          |</div><div class="line">| updated                             | 2017-08-31T02:01:31Z                           |</div><div class="line">| user_id                             | 4b19a4a2173543888ba8460d54d5eebd               |</div><div class="line">| volumes_attached                    |                                                |</div><div class="line">+-------------------------------------+------------------------------------------------+</div></pre></td></tr></table></figure></p>
<h4 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# nova list</div><div class="line">+--------------------------------------+----------------------------------------------+--------+------------+-------------+------------------------------+</div><div class="line">| ID                                   | Name                                         | Status | Task State | Power State | Networks                     |</div><div class="line">+--------------------------------------+----------------------------------------------+--------+------------+-------------+------------------------------+</div><div class="line">| 7648bfcf-a2c5-4028-b080-5ab62b218c9a | hadoop-cluster-new-vanilla-default-master1-0 | ACTIVE | -          | Running     | net1=10.10.0.7, 172.18.23.17 |</div><div class="line">| 970c02d3-0d7f-4e83-9866-be0ed25223a2 | hadoop-cluster-new-vanilla-default-worker1-0 | ACTIVE | -          | Running     | net1=10.10.0.10, 172.18.23.8 |</div><div class="line">| e057db81-eeed-40a4-b36c-ecdad7ade378 | hadoop-cluster-new-vanilla-default-worker1-1 | ACTIVE | -          | Running     | net1=10.10.0.6, 172.18.23.28 |</div><div class="line">| b36c5ee6-3b97-4e03-a0ef-f08e1866c0c8 | hadoop-cluster-new-vanilla-default-worker1-2 | ACTIVE | -          | Running     | net1=10.10.0.5               |</div><div class="line">| 54142f88-8170-4081-a2c0-b8da831a7dd1 | test                                         | ACTIVE | -          | Running     | network=172.18.23.11         |</div><div class="line">+--------------------------------------+----------------------------------------------+--------+------------+-------------+------------------------------+</div><div class="line">[root@control01 ~]# ping 172.18.23.11</div><div class="line">PING 172.18.23.11 (172.18.23.11) 56(84) bytes of data.</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=22 ttl=63 time=3.23 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=23 ttl=63 time=0.217 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=24 ttl=63 time=0.223 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=25 ttl=63 time=0.124 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=26 ttl=63 time=0.189 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=27 ttl=63 time=0.195 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=28 ttl=63 time=0.186 ms</div><div class="line">64 bytes from 172.18.23.11: icmp_seq=29 ttl=63 time=0.229 ms</div><div class="line">^C</div><div class="line">--- 172.18.23.11 ping statistics ---</div><div class="line">29 packets transmitted, 8 received, 72% packet loss, time 27999ms</div><div class="line">rtt min/avg/max/mdev = 0.124/0.575/3.239/1.007 ms</div></pre></td></tr></table></figure>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          李家旺
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="https://www.lijiawang.org/posts/kolla-ironic.html" title="kolla搭建ironic裸机服务" target="_blank">https://www.lijiawang.org/posts/kolla-ironic.html</a>
        </li>
        <li>
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow" target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
        </li>
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">kolla</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/openstack//" class="article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>


    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=https://www.lijiawang.org/posts/kolla-ironic.html" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
    <a href="/posts/ironic-instruction.html" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          ironic裸机服务使用说明
        
      </div>
    </a>
  
  
    <a href="/posts/python-class.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Python中类的定义与使用</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>













