<article id="post-openstack-glance" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 class="article-title" itemprop="name">
      opensyack glance学习
    </h1>
  


  
  
  
  
    
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">709字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">3分</span>
    </span>
  </span>
</div>


  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h3 id="openstack-Glance介绍"><a href="#openstack-Glance介绍" class="headerlink" title="openstack Glance介绍"></a>openstack Glance介绍</h3><p>Glance项目提供虚拟机镜像的发现，注册，取得服务。<br>Glance提供restful API可以查询虚拟机镜像的metadata，并且可以获得镜像。<br>通过Glance，虚拟机镜像可以被存储到多种存储上，比如简单的文件存储或者对象存储（比如OpenStack中swiftx项目）。<br>Glance，像所有的OpenStack项目一样，遵循以下思想：<br>1.基于组件的架构      便于快速增加新特性<br>2.高可用性                  支持大负荷<br>3.容错性                      独立的进程避免串行错误<br>4.开放标准                  对社区驱动的API提供参考实现<br><a id="more"></a></p>
<h3 id="Glance架构"><a href="#Glance架构" class="headerlink" title="Glance架构"></a>Glance架构</h3><p><img src="https://ljw.howieli.cn/blog/2017-10-26/glance架构图.png" alt=""><br>以上是glance架构图<br><a href="https://docs.openstack.org/glance/latest/" target="_blank" rel="external">glance官网</a></p>
<h3 id="glance服务"><a href="#glance服务" class="headerlink" title="glance服务"></a>glance服务</h3><p>我这是一个kolla环境<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# docker ps |grep glance</div><div class="line">1b240466af76        172.18.22.161:4000/99cloud/centos-source-glance-registry:animbus-5.3.0             "kolla_start"            2 weeks ago         Up 17 hours                                  glance_registry</div><div class="line">3f25b6ace631        172.18.22.161:4000/99cloud/centos-source-glance-api:animbus-5.3.0                  "kolla_start"            2 weeks ago         Up 17 hours                                  glance_api</div></pre></td></tr></table></figure></p>
<h3 id="glancce-api"><a href="#glancce-api" class="headerlink" title="glancce-api"></a>glancce-api</h3><p>glance-api 是系统后台运行的服务进程。 对外提供 REST API，响应 image 查询、获取和存储的调用。</p>
<p>glance-api 不会真正处理请求。 如果操作是与 image metadata（元数据）相关，glance-api 会把请求转发给 glance-registry； 如果操作是与 image 自身存取相关，glance-api 会把请求转发给该 image 的 store backend。<br>在控制节点可以查看glance-api的进程<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ps -e |grep glance-api</div><div class="line"> 4381 ?        00:09:56 glance-api</div><div class="line"> 9026 ?        00:00:14 glance-api</div><div class="line"> 9035 ?        00:00:11 glance-api</div><div class="line"> 9046 ?        00:00:14 glance-api</div><div class="line"> 9059 ?        00:00:16 glance-api</div><div class="line"> 9067 ?        00:00:13 glance-api</div></pre></td></tr></table></figure></p>
<h3 id="glance-registry"><a href="#glance-registry" class="headerlink" title="glance-registry"></a>glance-registry</h3><p>glance-registry 是系统后台运行的服务进程。 负责处理和存取 image 的 metadata，例如 image 的大小和类型。在控制节点上可以查看 glance-registry 进程.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@control01 ~]# ps -e |grep glance-registry</div><div class="line"> 2645 ?        00:00:03 glance-registry</div><div class="line"> 5351 ?        00:00:00 glance-registry</div><div class="line"> 5352 ?        00:00:00 glance-registry</div><div class="line"> 5353 ?        00:00:00 glance-registry</div><div class="line"> 5354 ?        00:00:00 glance-registry</div><div class="line"> 5355 ?        00:00:00 glance-registry</div></pre></td></tr></table></figure></p>
<h3 id="Store-backend"><a href="#Store-backend" class="headerlink" title="Store backend"></a>Store backend</h3><p>Glance 自己并不存储 image。 真正的 image 是存放在 backend 中的。 Glance 支持多种 backend，包括：</p>
<ul>
<li>A directory on a local file system（这是默认配置）</li>
<li>GridFS</li>
<li>Ceph RBD</li>
<li>Amazon S3</li>
<li>Sheepdog</li>
<li>OpenStack Block Storage (Cinder)</li>
<li>OpenStack Object Storage (Swift)</li>
<li>VMware ESX</li>
</ul>
<h3 id="image数据存放"><a href="#image数据存放" class="headerlink" title="image数据存放"></a>image数据存放</h3><p>image的元数据通过glance-registry存放到db中；image的chunk数据通过glance-store存放在各种 backend store 中，并从中获取。</p>
<h3 id="image的访问权限"><a href="#image的访问权限" class="headerlink" title="image的访问权限"></a>image的访问权限</h3><p>image 的 访问权限分为：</p>
<ul>
<li>public 公共的：可以被所有的 tenant 使用。</li>
<li>private 私有的/项目的：只能被 image owner 所在的 tenant 使用。</li>
<li>shared 共享的：一个非共有的image 可以 共享给另外的 tenant，可通过member-* 操作来实现。</li>
<li>protected 受保护的：protected 的 image 不能被删除。</li>
</ul>
<h3 id="image各种状态"><a href="#image各种状态" class="headerlink" title="image各种状态"></a>image各种状态</h3><ul>
<li>queued：没有上传 image 数据，只有db 中的元数据。</li>
<li>saving：正在上传 image data</li>
<li>active：正常状态</li>
<li>deleted/pending_delete： 已删除/等待删除</li>
<li>killed：image 元数据不正确，等待被删除。</li>
</ul>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          李家旺
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="https://www.lijiawang.org/posts/openstack-glance.html" title="opensyack glance学习" target="_blank">https://www.lijiawang.org/posts/openstack-glance.html</a>
        </li>
        <li>
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow" target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
        </li>
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/openstack//" class="article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>


    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=https://www.lijiawang.org/posts/openstack-glance.html" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
    <a href="/posts/kolla-pike-on-centos.html" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          kolla Pike on CentOS 7.4
        
      </div>
    </a>
  
  
    <a href="/posts/Openstack performance testing.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">openstack性能测试</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>













