<article id="post-harbor搭建" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 class="article-title" itemprop="name">
      harbor搭建
    </h1>
  


  
  
  
  
    
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">774字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">3分</span>
    </span>
  </span>
</div>


  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h3 id="harbor介绍"><a href="#harbor介绍" class="headerlink" title="harbor介绍"></a>harbor介绍</h3><p>Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源Docker Distribution。作为一个企业级私有Registry服务器，Harbor提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有Registry中， 确保数据和知识产权在公司内部网络中管控。另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等。</p>
<a id="more"></a>
<h3 id="配置网络yum源"><a href="#配置网络yum源" class="headerlink" title="配置网络yum源"></a>配置网络yum源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /etc/yum.repos.d</div><div class="line">rm -rf *</div><div class="line">cd</div><div class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</div><div class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</div></pre></td></tr></table></figure>
<h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 安装必要的一些系统工具</div><div class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</div><div class="line"># 添加软件源信息</div><div class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</div><div class="line"># 更新并安装 Docker-CE</div><div class="line">yum makecache fast</div><div class="line">yum -y install docker-ce</div><div class="line"># 开启Docker服务</div><div class="line">systemctl enable docker</div><div class="line">systemctl restart docker</div><div class="line">docker version</div></pre></td></tr></table></figure>
<h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h3><p>github上地址<a href="https://github.com/docker/compose" target="_blank" rel="external">https://github.com/docker/compose</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/docker/compose/releases/download/1.24.0/docker-compose-Linux-x86_64</div><div class="line">mv  docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</div><div class="line">chmod +x /usr/local/bin/docker-compose</div><div class="line">/usr/local/bin/docker-compose version</div></pre></td></tr></table></figure></p>
<h3 id="安装harbor"><a href="#安装harbor" class="headerlink" title="安装harbor"></a>安装harbor</h3><p>项目地址<a href="https://github.com/goharbor/harbor" target="_blank" rel="external">https://github.com/goharbor/harbor</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.5.tgz</div><div class="line">tar  xf harbor-offline-installer-v1.7.5.tgz -C /usr/share/</div><div class="line">[root@harbor ~]# ll /usr/share/harbor/</div><div class="line">total 572840</div><div class="line">drwxr-xr-x. 3 root root        23 May 14 16:08 common</div><div class="line">-rw-r--r--. 1 root root       939 Apr  1 12:07 docker-compose.chartmuseum.yml</div><div class="line">-rw-r--r--. 1 root root       975 Apr  1 12:07 docker-compose.clair.yml</div><div class="line">-rw-r--r--. 1 root root      1434 Apr  1 12:07 docker-compose.notary.yml</div><div class="line">-rw-r--r--. 1 root root      5608 Apr  1 12:07 docker-compose.yml</div><div class="line">-rw-r--r--. 1 root root      8033 Apr  1 12:07 harbor.cfg</div><div class="line">-rw-r--r--. 1 root root 585234819 Apr  1 12:08 harbor.v1.7.5.tar.gz</div><div class="line">-rwxr-xr-x. 1 root root      5739 Apr  1 12:07 install.sh</div><div class="line">-rw-r--r--. 1 root root     11347 Apr  1 12:07 LICENSE</div><div class="line">-rw-r--r--. 1 root root   1263409 Apr  1 12:07 open_source_license</div><div class="line">-rwxr-xr-x. 1 root root     36337 Apr  1 12:07 prepare</div></pre></td></tr></table></figure></p>
<h3 id="修改harbor配置文件harbor-cfg"><a href="#修改harbor配置文件harbor-cfg" class="headerlink" title="修改harbor配置文件harbor.cfg"></a>修改harbor配置文件harbor.cfg</h3><p>在刚才解压完的目录下有harbor配置文件: harbor.cfg, 这里有几处必要配置需要修改:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> hostname设置访问地址，可以使用ip、域名，不可以设置为127.0.0.1或localhost</span></div><div class="line">hostname = 192.168.1.109</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 访问协议，默认是http，也可以设置https，如果设置https，则nginx ssl需要设置on</span></div><div class="line">ui_url_protocol = http</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> mysql数据库root用户默认密码root123，实际使用时修改下</span></div><div class="line">db_password = root123</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 启动Harbor后，管理员UI登录的密码，默认是Harbor12345</span></div><div class="line">harbor_admin_password = Harbor12345</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> 是否开启自注册</span></div><div class="line">self_registration = on</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> Token有效时间，默认30分钟</span></div><div class="line">token_expiration = 30</div></pre></td></tr></table></figure></p>
<h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/share/harbor/</div><div class="line">./install.sh</div></pre></td></tr></table></figure>
<p><img src="https://ljw.howieli.cn/blog/2019-05-14/harborlogin.png" alt=""><br><img src="https://ljw.howieli.cn/blog/2019-05-14/harbor1.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cat /etc/docker/daemon.json </div><div class="line">&#123;</div><div class="line">  &quot;insecure-registries&quot;: [&quot;10.122.52.227&quot;]</div><div class="line">&#125;</div><div class="line"># 重启docker服务</div><div class="line">systemctl restart docker</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>
<h3 id="将镜像push到Harbor"><a href="#将镜像push到Harbor" class="headerlink" title="将镜像push到Harbor"></a>将镜像push到Harbor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">docker images|grep centos</div><div class="line">centos                          latest              9f38484d220f        2 months ago        202MB</div><div class="line"></div><div class="line">docker tag centos:latest 10.122.52.227/library/centos:latest</div><div class="line"></div><div class="line"># docker images|grep centos</div><div class="line">10.122.52.227/library/centos    latest              9f38484d220f        2 months ago        202MB</div><div class="line">centos                          latest              9f38484d220f        2 months ago        202MB</div><div class="line"></div><div class="line">docker push 10.122.52.227/library/centos:latest</div></pre></td></tr></table></figure>
<p><img src="https://ljw.howieli.cn/blog/2019-05-14/login.png" alt=""><br><img src="https://ljw.howieli.cn/blog/2019-05-14/harbor2.png" alt=""></p>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          李家旺
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="https://www.lijiawang.org/posts/harbor搭建.html" title="harbor搭建" target="_blank">https://www.lijiawang.org/posts/harbor搭建.html</a>
        </li>
        <li>
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow" target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
        </li>
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">docker</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/docker//" class="article-tag-list-link color2">docker</a>
        		</li>
      		
		</ul>
	</div>


    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=https://www.lijiawang.org/posts/harbor搭建.html" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
    <a href="/posts/使用kubeadm搭建kubernetes1.15.html" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          使用kubeadm搭建kubernetes1.15
        
      </div>
    </a>
  
  
    <a href="/posts/使用Kubeadm安装最新版Kubernetes 1.12.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">使用Kubeadm安装最新版Kubernetes 1.12</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>













