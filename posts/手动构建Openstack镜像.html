<article id="post-手动构建Openstack镜像" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 class="article-title" itemprop="name">
      手动构建Openstack镜像
    </h1>
  


  
  
  
  
    
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">2.3k字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">9分</span>
    </span>
  </span>
</div>


  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h3 id="手动构建Openstack镜像"><a href="#手动构建Openstack镜像" class="headerlink" title="手动构建Openstack镜像"></a>手动构建Openstack镜像</h3><p>本文以centos7镜像为例，详细介绍手动制作Openstack镜像的步骤，镜像支持一下几个功能：</p>
<ul>
<li>支持密码注入功能(nova boot时通过–admin-pass参数指定设置初始密码）</li>
<li>支持根分区自动调整(根分区自动调整为flavor disk大小，而不是原始镜像分区大小)</li>
<li>支持动态修改密码(使用nova set-password命令可以修改管理员密码)</li>
</ul>
<p>镜像的宿主机操作系统为CentOs7.4，开启了VT功能(使用kvm-ok命令验证)并安装了libvirt系列工具，包括virsh、virt-manager、libguestfs-tools等。</p>
<a id="more"></a>
<h3 id="下载iso镜像"><a href="#下载iso镜像" class="headerlink" title="下载iso镜像"></a>下载iso镜像</h3><p>下载centos7.4.iso镜像，可以选择中国镜像源，相对国外镜像源下载速度会快很多，这里我已经下载好了。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> qemu-img info CentOS-7-x86_64-DVD-1708.iso </span></div><div class="line">image: CentOS-7-x86_64-DVD-1708.iso</div><div class="line">file format: raw</div><div class="line">virtual size: 4.2G (4521459712 bytes)</div><div class="line">disk size: 4.2G</div></pre></td></tr></table></figure></p>
<h3 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h3><p>首先创建一个qcow2格式镜像文件，用于虚拟机的根磁盘，大小10G就够了。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> qemu-img create <span class="_">-f</span> qcow2 centos.qcow2 10G</span></div><div class="line">Formatting 'centos.qcow2', fmt=qcow2 size=10737418240 encryption=off cluster_size=65536 lazy_refcounts=off</div></pre></td></tr></table></figure></p>
<p>使用以下脚本创建并启动虚拟机：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NAME=centos</div><div class="line">ROOT_DISK=centos.qcow2</div><div class="line">CDROM=`pwd`/CentOS-7-x86_64-DVD-1708.iso</div><div class="line">virt-install --virt-type kvm --name $NAME --ram 1024 \</div><div class="line">--disk $ROOT_DISK,format=qcow2 \</div><div class="line">--network network=default \</div><div class="line">--graphics vnc,listen=0.0.0.0 --noautoconsole \</div><div class="line">--os-type=linux --os-variant=rhel7 \</div><div class="line">--cdrom=$CDROM</div></pre></td></tr></table></figure></p>
<p>启动完成后，使用vnc client连接或者使用virt-manager、virt-viewer连接,这里我直接用virt-manager。</p>
<h3 id="安装OS"><a href="#安装OS" class="headerlink" title="安装OS"></a>安装OS</h3><p>进入虚拟机控制台可以看到CentOS的启动菜单，选择Install Centos 7，继续选择语言后将进入INSTALLION SUMMARY，其中大多数配置默认即可，SOFTWARE SELECTION选择Minimal Install，INSTALLATION DESTINATION需要选择手动配置分区，我们只需要一个根分区即可，不需要swap分区，文件系统选择ext4或者xfs，存储驱动选择Virtio Block Device，如图：<br><img src="https://ljw.howieli.cn/blog/2018-1-12/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20180112113728.png" alt=""></p>
<p>配置完成后就可以开始安装了，在CONFIGURATION中设置root临时密码，只需要暂时记住这个临时密码，制作完后cloud-init会重新设置root初始密码。</p>
<p>大约几分钟后，即可自动完成安装配置工作，最后点击右下角的reboot重启退出虚拟机。</p>
<h3 id="配置OS"><a href="#配置OS" class="headerlink" title="配置OS"></a>配置OS</h3><p>安装好操作系统后，需要进行配置才能作为glance镜像使用，启动虚拟机<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> virsh list --all</span></div><div class="line"> Id    名称                         状态</div><div class="line">----------------------------------------------------</div><div class="line"> -     centos                         关闭</div><div class="line"><span class="meta">#</span><span class="bash"> virsh start centos</span></div></pre></td></tr></table></figure></p>
<p>如果云主机不需要支持root ssh远程登录，需要关闭root远程ssh登录功能，修改配置文件/etc/ssh/sshd_config并修改PermitRootLogin值为no，默认是开启的（这里我不做更改，如果更改需要重启ssh服务生效）。</p>
<p>为了加快安装速度，可以配置为本地软件源仓库，若没有本地镜像仓库，则选择国内的软件源，相对官网的速度下载要快。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum -y install wget</span></div><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; rm -rf * &amp;&amp; <span class="built_in">cd</span></span></div><div class="line"><span class="meta">#</span><span class="bash"> wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></div><div class="line"><span class="meta">#</span><span class="bash"> wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></div></pre></td></tr></table></figure></p>
<h3 id="acpid"><a href="#acpid" class="headerlink" title="acpid"></a>acpid</h3><p><a href="https://wiki.archlinux.org/index.php/Acpid" target="_blank" rel="external">acpid</a>是一个用户空间的服务进程, 用来处理电源相关事件,比如将kernel中的电源事件转发给应用程序，告诉应用程序安全的退出，防止应用程序异常退出导致数据损坏。libvirt可以通过向guest虚拟机发送acpid事件触发电源操作，使虚拟机安全关机、重启等操作，相对于强制执行关闭电源操作更安全。通过acpid事件发送开关机信号即我们经常所说的软重启或者软关机。<br>为了支持软操作，虚拟机需要安装acpid服务，并设置开机自启动：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum -y install acpid</span></div><div class="line"><span class="meta">#</span><span class="bash"> systemctl <span class="built_in">enable</span> acpid</span></div></pre></td></tr></table></figure></p>
<p>提示：</p>
<ul>
<li>用户执行重启或者关机操作时，OpenStack会首先尝试调用libvirt的shutdown方法，即软关机。</li>
<li>当软关机执行失败或者超时(默认120秒)，则会调动libvirt的destroy方法，即强制关机，因此如果虚拟机关机或者重启很慢，很可能是acpid没有正常运行。</li>
<li>为了使虚拟机进程安全退出，减少数据损坏风险，尽量使用软操作，硬操作可能导致程序崩溃或者数据丢失。</li>
</ul>
<h3 id="console-log"><a href="#console-log" class="headerlink" title="console log"></a>console log</h3><p>当操作系统内核崩溃时会报出内核系统crash出错信息，通常启动的时候一闪而过, 而此时系统还没有起来，不能通过远程工具(比如ssh)进入系统查看，我们可以通过配置grub，把这些日志重定向到Serial Console中，这样我们就可以通过Serial console来访问错误信息，以供分析和排错使用。<br>修改配置文件/etc/default/grub，设置GRUB_CMDLINE_LINUX，：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRUB_CMDLINE_LINUX="crashkernel=auto console=tty0 console=ttyS0,115200n8"</div></pre></td></tr></table></figure></p>
<p>通过这个配置，内核信息会以115200的波特率同时发送到tty0和ttyS0串行端口设备。libvirt可以通过一个普通文件模拟这个串行端口：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">serial</span> <span class="attr">type</span>=<span class="string">'file'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">path</span>=<span class="string">'/var/lib/nova/instances/99579ce1-f4c4-4031-a56c-68e85a3d037a/console.log'</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">port</span>=<span class="string">'0'</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">serial</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样内核产生的日志发到ttyS0，实际上写到console.log文件中。</p>
<p>OpenStack通过nova console-log命令可以获取该文件内容，查看错误日志。</p>
<h3 id="qemu-guest-agent"><a href="#qemu-guest-agent" class="headerlink" title="qemu-guest-agent"></a>qemu-guest-agent</h3><p>qemu-guest-agent是运行在虚拟机内部的一个服务，libvirt会在本地创建一个unix socket，模拟为虚拟机内部的一个串口设备，从而实现了宿主机与虚拟机通信，这种方式不依赖于TCP/IP网络，实现方式简单方便。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">channel</span> <span class="attr">type</span>=<span class="string">'unix'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">mode</span>=<span class="string">'bind'</span> <span class="attr">path</span>=<span class="string">'/var/lib/libvirt/qemu/org.qemu.guest_agent.0.instance-00003c2c.sock'</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">type</span>=<span class="string">'virtio'</span> <span class="attr">name</span>=<span class="string">'org.qemu.guest_agent.0'</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'virtio-serial'</span> <span class="attr">controller</span>=<span class="string">'0'</span> <span class="attr">bus</span>=<span class="string">'0'</span> <span class="attr">port</span>=<span class="string">'1'</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">channel</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>如上宿主机的socket文件为org.qemu.guest_agent.0.instance-00003c2c.sock，在虚拟机内部为/dev/virtio-ports/org.qemu.guest_agent.0。</p>
<p>通过这种方式，宿主机可以发送指令写到socket文件中，虚拟机内部的qemu-guest-agent会轮询查看这个串行设备是否有指令，一旦接收到指令就可以执行对应的脚本，从而实现了宿主机控制虚拟机执行命令的功能，其中最常用的指令就是通过libvirt修改虚拟机密码。更多关于qemu-guest-agent请参考<a href="http://link.zhihu.com/?target=http%3A//wiki.qemu.org/Features/QAPI/GuestAgent" target="_blank" rel="external">官方文档</a>。</p>
<p>为了支持OpenStack平台动态修改虚拟机密码功能，我们需要手动安装qemu-guest-agent：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum install -y qemu-guest-agent</span></div></pre></td></tr></table></figure></p>
<p>修改/etc/sysconfig/qemu-ga配置文件:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">virsh qemu-agent-command instance-000028d5 '&#123;"execute":"guest-info"&#125;' | python -m json.tool | grep 'name' | cut -d ':' -f 2 | tr -d '",'</div><div class="line"> ...</div><div class="line"> guest-set-user-password</div><div class="line"> guest-get-fsinfo</div><div class="line"> guest-set-vcpus</div><div class="line"> guest-get-vcpus</div><div class="line"> ...</div></pre></td></tr></table></figure></p>
<p>确认包含guest-set-user-password指令，支持修改管理员密码。</p>
<h3 id="zeroconf"><a href="#zeroconf" class="headerlink" title="zeroconf"></a>zeroconf</h3><p>zeroconf启动时会自动创建一条路由169.254.0.0/16，而虚拟机访问metadata服务的地址正好是169.254.169.254，如果启动了zeroconf服务，由于路由冲突，虚拟机不能通过169.254.169.254路由到网络节点的metadata服务了。OpenStack虚拟机通常都是通过DHCP获取IP的，因此我们并不需要zeroconf服务。为了虚拟机能够访问metadata服务，我们必须禁止zeroconf服务，关于该问题的更详细讨论可参考<a href="https://zhuanlan.zhihu.com/p/30385809" target="_blank" rel="external">bug#983611</a>：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"NOZEROCONF=yes"</span> &gt;&gt; /etc/sysconfig/network</span></div></pre></td></tr></table></figure></p>
<h3 id="cloud-init"><a href="#cloud-init" class="headerlink" title="cloud-init"></a>cloud-init</h3><p>接下来安装cloud-init，cloud-init是虚拟机第一次启动时执行的脚本，主要负责从metadata服务中拉取配置信息，完成虚拟机的初始化工作，比如设置主机名、初始化密码以及注入密钥等。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum install -y cloud-init</span></div></pre></td></tr></table></figure></p>
<h3 id="growpart"><a href="#growpart" class="headerlink" title="growpart"></a>growpart</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum update -y</span></div><div class="line"><span class="meta">#</span><span class="bash"> yum install -y epel-release</span></div><div class="line"><span class="meta">#</span><span class="bash"> yum install -y cloud-utils-growpart.x86.64</span></div><div class="line"><span class="meta">#</span><span class="bash"> rpm -qa kernel | sed <span class="string">'s/^kernel-//'</span>  | xargs -I &#123;&#125; dracut <span class="_">-f</span> /boot/initramfs-&#123;&#125;.img &#123;&#125;</span></div></pre></td></tr></table></figure>
<p>完成以上工作后，我们的镜像配置基本结束，删除一些无用文件，清理history命令后执行关机：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> shutdown -h now</span></div></pre></td></tr></table></figure></p>
<h3 id="移除本地信息"><a href="#移除本地信息" class="headerlink" title="移除本地信息"></a>移除本地信息</h3><p>在宿主机上运行以下命名，移除宿主机信息，比如mac地址等。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> virt-sysprep <span class="_">-d</span> centos</span></div><div class="line">[   0.0] Examining the guest ...</div><div class="line">[  41.1] Performing "abrt-data" ...</div><div class="line">[  42.4] Performing "backup-files" ...</div><div class="line">[  44.4] Performing "bash-history" ...</div><div class="line">[  44.4] Performing "blkid-tab" ...</div><div class="line">[  44.5] Performing "crash-data" ...</div><div class="line">[  44.5] Performing "cron-spool" ...</div><div class="line">[  44.5] Performing "dhcp-client-state" ...</div><div class="line">[  44.5] Performing "dhcp-server-state" ...</div><div class="line">[  44.5] Performing "dovecot-data" ...</div><div class="line">[  44.5] Performing "logfiles" ...</div><div class="line">[  44.7] Performing "machine-id" ...</div><div class="line">[  44.7] Performing "mail-spool" ...</div><div class="line">[  44.7] Performing "net-hostname" ...</div><div class="line">[  44.8] Performing "net-hwaddr" ...</div><div class="line">[  44.8] Performing "pacct-log" ...</div><div class="line">[  44.8] Performing "package-manager-cache" ...</div><div class="line">[  44.8] Performing "pam-data" ...</div><div class="line">[  44.8] Performing "passwd-backups" ...</div><div class="line">[  44.8] Performing "puppet-data-log" ...</div><div class="line">[  44.8] Performing "rh-subscription-manager" ...</div><div class="line">[  44.8] Performing "rhn-systemid" ...</div><div class="line">[  44.8] Performing "rpm-db" ...</div><div class="line">[  44.8] Performing "samba-db-log" ...</div><div class="line">[  44.8] Performing "script" ...</div><div class="line">[  44.8] Performing "smolt-uuid" ...</div><div class="line">[  44.8] Performing "ssh-hostkeys" ...</div><div class="line">[  44.8] Performing "ssh-userdir" ...</div><div class="line">[  44.8] Performing "sssd-db-log" ...</div><div class="line">[  44.9] Performing "tmp-files" ...</div><div class="line">[  44.9] Performing "udev-persistent-net" ...</div><div class="line">[  44.9] Performing "utmp" ...</div><div class="line">[  44.9] Performing "yum-uuid" ...</div><div class="line">[  44.9] Performing "customize" ...</div><div class="line">[  44.9] Setting a random seed</div><div class="line">[  45.4] Performing "lvm-uuids" ...</div></pre></td></tr></table></figure></p>
<p>删除虚拟机，镜像制作完成。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> virsh list --all</span></div><div class="line"> Id    名称                         状态</div><div class="line">----------------------------------------------------</div><div class="line"> -     centos                         关闭</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> virsh undefine centos</span></div><div class="line">域 centos 已经被取消定义</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> virsh list --all</span></div><div class="line"> Id    名称                         状态</div><div class="line">----------------------------------------------------</div></pre></td></tr></table></figure></p>
<h3 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h3><p>镜像制作完成，上传centos.qcow2到glance服务中<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> glance image-create --file ./centos.qcow2 --disk-format qcow2 \</span></div><div class="line">    --container-format bare --name CentOS-7.2 --progress</div></pre></td></tr></table></figure></p>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          李家旺
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="https://www.lijiawang.org/posts/手动构建Openstack镜像.html" title="手动构建Openstack镜像" target="_blank">https://www.lijiawang.org/posts/手动构建Openstack镜像.html</a>
        </li>
        <li>
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow" target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
        </li>
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/openstack//" class="article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>


    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=https://www.lijiawang.org/posts/手动构建Openstack镜像.html" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
    <a href="/posts/ceph写流程分析.html" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          ceph写流程分析
        
      </div>
    </a>
  
  
    <a href="/posts/ceph ( requests are blocked ) 异常解决方法.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">ceph ( requests are blocked ) 异常解决方法</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>













