

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;auto&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="不看官网不足以熟练，不懂源码不足以精通">
  <meta name="author" content="李家旺">
  <meta name="keywords" content="linux, python, shell, openstack">
  <title>使用kubeadm搭建kubernetes1.15 - 李家旺</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.lijiawang.org","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="李家旺" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>李家旺</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="使用kubeadm搭建kubernetes1.15">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2019-09-01 22:07" pubdate>
        2019年9月1日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      41
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">使用kubeadm搭建kubernetes1.15</h1>
            
            <div class="markdown-body">
              <h3 id="使用kubeadm方式安装kubernetes"><a href="#使用kubeadm方式安装kubernetes" class="headerlink" title="使用kubeadm方式安装kubernetes"></a>使用<code>kubeadm</code>方式安装<code>kubernetes</code></h3><a id="more"></a>

<p>[TOC]</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>在所有节点执行，此环节所有的节点操作系统均匀<code>centos7.6</code></p>
<h4 id="1、配置hosts解析"><a href="#1、配置hosts解析" class="headerlink" title="1、配置hosts解析"></a>1、配置<code>hosts</code>解析</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> cat /etc/hosts</span><br>10.122.17.206 k8s-node3<br>10.122.17.205 k8s-node2<br>10.122.17.204 k8s-node1<br>10.122.17.200 k8s-master<br><span class="hljs-meta">#</span><span class="bash"> masker 主机到node免密</span><br></code></pre></td></tr></table></figure>
<h4 id="2、禁用防火墙"><a href="#2、禁用防火墙" class="headerlink" title="2、禁用防火墙"></a>2、禁用防火墙</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop firewalld<br>systemctl disable firewalld<br></code></pre></td></tr></table></figure>

<h4 id="3、禁用SELINUX"><a href="#3、禁用SELINUX" class="headerlink" title="3、禁用SELINUX"></a>3、禁用<code>SELINUX</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> setenforce 0</span><br><span class="hljs-meta">#</span><span class="bash"> sed -i <span class="hljs-string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br><span class="hljs-meta">#</span><span class="bash"> cat /etc/selinux/config</span><br>SELINUX=disabled<br></code></pre></td></tr></table></figure>
<h4 id="4、创建-etc-sysctl-d-k8s-conf-添加如下内容-并使修改生效"><a href="#4、创建-etc-sysctl-d-k8s-conf-添加如下内容-并使修改生效" class="headerlink" title="4、创建/etc/sysctl.d/k8s.conf,添加如下内容,并使修改生效"></a>4、创建<code>/etc/sysctl.d/k8s.conf</code>,添加如下内容,并使修改生效</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> cat /etc/sysctl.d/k8s.conf</span> <br>net.bridge.bridge-nf-call-ip6tables = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>net.ipv4.ip_forward = 1<br><span class="hljs-meta">#</span><span class="bash"> modprobe br_netfilter</span><br><span class="hljs-meta">#</span><span class="bash"> sysctl -p /etc/sysctl.d/k8s.conf</span><br></code></pre></td></tr></table></figure>
<h4 id="5、安装ipvs"><a href="#5、安装ipvs" class="headerlink" title="5、安装ipvs"></a>5、安装ipvs</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># cat &gt; <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/i</span>pvs.modules &lt;&lt;EOF<br>#!<span class="hljs-regexp">/bin/</span>bash<br>modprobe -- ip_vs<br>modprobe -- ip_vs_rr<br>modprobe -- ip_vs_wrr<br>modprobe -- ip_vs_sh<br>modprobe -- nf_conntrack_ipv4<br>EOF<br># chmod <span class="hljs-number">755</span> <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/i</span>pvs.modules &amp;&amp; bash <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/i</span>pvs.modules &amp;&amp; lsmod | <span class="hljs-keyword">grep</span> -e ip_vs -e nf_conntrack_ipv4<br></code></pre></td></tr></table></figure>
<p>上面脚本创建了的<code>/etc/sysconfig/modules/ipvs.modules</code>文件，保证在节点重启后能自动加载所需模块。使用<code>lsmod | grep -e ip_vs -e nf_conntrack_ipv4</code>命令查看是否已经正确加载所需的内核模块。<br>接下来还需要确保各个节点上已经安装了 ipset 软件包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install ipset -y</span><br></code></pre></td></tr></table></figure>
<p>为了便于查看 <code>ipvs</code> 的代理规则，最好安装一下管理工具 <code>ipvsadm</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum -y install ipvsadm -y</span><br></code></pre></td></tr></table></figure>
<h4 id="6、安装时间同步服务"><a href="#6、安装时间同步服务" class="headerlink" title="6、安装时间同步服务"></a>6、安装时间同步服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install chrony -y</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl <span class="hljs-built_in">enable</span> chronyd</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl start chronyd</span><br><span class="hljs-meta">#</span><span class="bash"> chronyc sources</span><br></code></pre></td></tr></table></figure>
<h4 id="7、关闭swap分区"><a href="#7、关闭swap分区" class="headerlink" title="7、关闭swap分区"></a>7、关闭swap分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> swapoff -a</span><br></code></pre></td></tr></table></figure>
<p>修改<code>/etc/fstab</code>文件，注释掉<code>SWAP</code>的自动挂载，使用<code>free -m</code>确认<code>swap</code>已经关闭。<code>swappiness</code>参数调整，修改<code>/etc/sysctl.d/k8s.conf</code>添加下面一行：</p>
<h4 id="8、安装docker-ce"><a href="#8、安装docker-ce" class="headerlink" title="8、安装docker-ce"></a>8、安装<code>docker-ce</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="hljs-meta">#</span><span class="bash"> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="hljs-meta">#</span><span class="bash"> yum makecache fast</span><br><span class="hljs-meta">#</span><span class="bash"> yum list docker-ce --showduplicates | sort -r</span><br><span class="hljs-meta">#</span><span class="bash"> 可以选择安装一个版本，比如我们这里安装最新版本</span><br><span class="hljs-meta">#</span><span class="bash"> yum install docker-ce-19.03.1-3.el7 -y</span><br></code></pre></td></tr></table></figure>
<h4 id="9、配置Docker镜像加速器"><a href="#9、配置Docker镜像加速器" class="headerlink" title="9、配置Docker镜像加速器"></a>9、配置<code>Docker</code>镜像加速器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt;/etc/docker/daemon.json<br>&#123;<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>  &quot;registry-mirrors&quot; : [<br>    &quot;https://ot2k4d59.mirror.aliyuncs.com/&quot;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure>
<h4 id="10、启动Docker"><a href="#10、启动Docker" class="headerlink" title="10、启动Docker"></a>10、启动<code>Docker</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> systemctl daemon-reload</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl restart docker</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl <span class="hljs-built_in">enable</span> docker</span><br></code></pre></td></tr></table></figure>
<h4 id="11、安装kubeadm、kubelet、kubectl"><a href="#11、安装kubeadm、kubelet、kubectl" class="headerlink" title="11、安装kubeadm、kubelet、kubectl"></a>11、安装<code>kubeadm</code>、<code>kubelet</code>、<code>kubectl</code></h4><p>配置<code>yum</code>源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo<br>[kubernetes]<br>name=Kubernetes<br>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/<br>enabled=1<br>gpgcheck=1<br>repo_gpgcheck=1<br>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg<br>EOF<br></code></pre></td></tr></table></figure>
<p>安装<code>kubeadm</code>、<code>kubelet</code>、<code>kubectl</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes -y</span><br><span class="hljs-meta">#</span><span class="bash"> kubeadm version</span><br>kubeadm version: &amp;version.Info&#123;Major:&quot;1&quot;, Minor:&quot;15&quot;, GitVersion:&quot;v1.15.3&quot;, GitCommit:&quot;2d3c76f9091b6bec110a5e63777c332469e0cba2&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-08-19T11:11:18Z&quot;, GoVersion:&quot;go1.12.9&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;<br></code></pre></td></tr></table></figure>
<p>将 <code>kubelet</code> 设置成开机启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> systemctl <span class="hljs-built_in">enable</span> kubelet.service</span><br></code></pre></td></tr></table></figure>
<p>到这里为止上面所有的操作都需要在所有节点执行配置</p>
<h3 id="初始化集群"><a href="#初始化集群" class="headerlink" title="初始化集群"></a>初始化集群</h3><h4 id="1、在master节点配置配置kubeadm初始文件"><a href="#1、在master节点配置配置kubeadm初始文件" class="headerlink" title="1、在master节点配置配置kubeadm初始文件"></a>1、在master节点配置配置kubeadm初始文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">  kubeadm config <span class="hljs-built_in">print</span> init-defaults &gt; kubeadm.yaml</span><br><span class="hljs-meta">#</span><span class="bash"> cat kubeadm.yaml</span> <br>apiVersion: kubeadm.k8s.io/v1beta2<br>bootstrapTokens:<br>- groups:<br>  - system:bootstrappers:kubeadm:default-node-token<br>  token: abcdef.0123456789abcdef<br>  ttl: 24h0m0s<br>  usages:<br>  - signing<br>  - authentication<br>kind: InitConfiguration<br>localAPIEndpoint:<br>  advertiseAddress: 10.122.17.200   # apiserver 节点内网IP<br>  bindPort: 6443<br>nodeRegistration:<br>  criSocket: /var/run/dockershim.sock<br>  name: k8s-master<br>  taints:<br>  - effect: NoSchedule<br>    key: node-role.kubernetes.io/master<br>---<br>apiServer:<br>  timeoutForControlPlane: 4m0s<br>apiVersion: kubeadm.k8s.io/v1beta2<br>certificatesDir: /etc/kubernetes/pki<br>clusterName: kubernetes<br>controllerManager: &#123;&#125;<br>dns:<br>  type: CoreDNS<br>etcd:<br>  local:<br>    dataDir: /var/lib/etcd<br>imageRepository: registry.aliyuncs.com/google_containers    # 科学上网使用阿里registry源<br>kind: ClusterConfiguration<br>kubernetesVersion: v1.15.3    # k8s版本<br>networking:<br>  dnsDomain: cluster.local<br>  podSubnet: 192.168.0.0/16   # 我们这里是准备安装 calico 网络插件的，需要将 networking.podSubnet 设置为192.168.0.0/16<br>  serviceSubnet: 10.96.0.0/12<br>scheduler: &#123;&#125;<br>---<br>apiVersion: kubeproxy.config.k8s.io/v1alpha1<br>kind: KubeProxyConfiguration<br>mode: ipvs       # kube-proxy 模式<br></code></pre></td></tr></table></figure>
<h4 id="2、初始化master配置文件"><a href="#2、初始化master配置文件" class="headerlink" title="2、初始化master配置文件"></a>2、初始化<code>master</code>配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubeadm init --config kubeadm.yaml</span><br>Your Kubernetes control-plane has initialized successfully!<br><br>To start using your cluster, you need to run the following as a regular user:<br><br>  mkdir -p $HOME/.kube<br>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>  sudo chown $(id -u):$(id -g) $HOME/.kube/config<br><br>You should now deploy a pod network to the cluster.<br>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:<br>  https://kubernetes.io/docs/concepts/cluster-administration/addons/<br><br>Then you can join any number of worker nodes by running the following on each as root:<br><br>kubeadm join 10.122.17.200:6443 --token abcdef.0123456789abcdef \<br>    --discovery-token-ca-cert-hash sha256:44a4ed41c1f69a23139b5d1e2bb6ec158d835257c6aab0a7607a122e77f51c04 <br></code></pre></td></tr></table></figure>
<h4 id="3、拷贝-kubeconfig-文件"><a href="#3、拷贝-kubeconfig-文件" class="headerlink" title="3、拷贝 kubeconfig 文件"></a>3、拷贝 kubeconfig 文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mkdir -p <span class="hljs-variable">$HOME</span>/.kube</span><br><span class="hljs-meta">#</span><span class="bash"> sudo cp -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config</span><br><span class="hljs-meta">#</span><span class="bash"> sudo chown $(id -u):$(id -g) <span class="hljs-variable">$HOME</span>/.kube/config</span><br></code></pre></td></tr></table></figure>
<h4 id="4、kubectl自动补全"><a href="#4、kubectl自动补全" class="headerlink" title="4、kubectl自动补全"></a>4、kubectl自动补全</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install -y bash-completion</span><br><span class="hljs-meta">#</span><span class="bash"> locate bash_completion</span><br>/etc/bash_completion.d<br>/etc/bash_completion.d/git<br>/etc/bash_completion.d/iprutils<br>/etc/bash_completion.d/oscap<br>/etc/bash_completion.d/redefine_filedir<br>/etc/bash_completion.d/scl.bash<br>/etc/bash_completion.d/yum-utils.bash<br>/etc/profile.d/bash_completion.sh<br>/root/naftis/vendor/github.com/spf13/cobra/bash_completions.go<br>/usr/share/bash-completion/bash_completion<br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;source /usr/share/bash-completion/bash_completion&#x27;</span> &gt;&gt; .bashrc</span> <br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt;.bashrc</span><br></code></pre></td></tr></table></figure>
<h3 id="添加计算节点"><a href="#添加计算节点" class="headerlink" title="添加计算节点"></a>添加计算节点</h3><h4 id="1、使用kubeadm添加计算节点"><a href="#1、使用kubeadm添加计算节点" class="headerlink" title="1、使用kubeadm添加计算节点"></a>1、使用<code>kubeadm</code>添加计算节点</h4><p><code>node</code>节点记住初始化集群上面的配置和操作要提前做好，必须安装好<code>kubeadm</code>、<code>kubelet</code>，执行以下命名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubeadm join 10.122.17.200:6443 --token abcdef.0123456789abcdef \</span><br><span class="bash">    --discovery-token-ca-cert-hash sha256:44a4ed41c1f69a23139b5d1e2bb6ec158d835257c6aab0a7607a122e77f51c04</span> <br></code></pre></td></tr></table></figure>
<p>如果忘记了上面的<code>join</code>命令可以在<code>master</code>节点使用命令<code>kubeadm token create --print-join-command</code>重新获取,如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubeadm token create --print-join-command</span><br>kubeadm join 10.122.17.200:6443 --token dkb75n.dxkqjiv96eu7ky2s \<br>    --discovery-token-ca-cert-hash sha256:44a4ed41c1f69a23139b5d1e2bb6ec158d835257c6aab0a7607a122e77f51c04 <br></code></pre></td></tr></table></figure>
<h4 id="2、执行成功后可以在master节点运行kubectl-get-nodes命令"><a href="#2、执行成功后可以在master节点运行kubectl-get-nodes命令" class="headerlink" title="2、执行成功后可以在master节点运行kubectl get nodes命令"></a>2、执行成功后可以在<code>master</code>节点运行<code>kubectl get nodes</code>命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl get nodes</span><br>NAME         STATUS      ROLES    AGE     VERSION<br>k8s-master   NotReady    master   3m    v1.15.3<br>k8s-node1    NotReady    &lt;none&gt;   48m   v1.15.3<br>k8s-node2    NotReady    &lt;none&gt;   24m   v1.15.3<br>k8s-node3    NotReady    &lt;none&gt;   13m   v1.15.3<br></code></pre></td></tr></table></figure>
<p>可以看到是<code>NotReady</code>状态，这是因为还没有安装网络插件，接下来安装网络插件</p>
<h3 id="安装calio网络组建"><a href="#安装calio网络组建" class="headerlink" title="安装calio网络组建"></a>安装<code>calio</code>网络组建</h3><p>以下命令在控制节点执行</p>
<h4 id="1、安装calio网络插件"><a href="#1、安装calio网络插件" class="headerlink" title="1、安装calio网络插件"></a>1、安装<code>calio</code>网络插件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">  wget https://docs.projectcalico.org/v3.8/manifests/calico.yaml</span><br><span class="hljs-meta">#</span><span class="bash">  如果节点是多网卡，可以在资源清单文件中指定内网网卡</span><br><span class="hljs-meta">#</span><span class="bash"> vi calico.yaml</span><br>......<br>spec:<br>  containers:<br>  - env:<br>    - name: DATASTORE_TYPE<br>      value: kubernetes<br>    - name: IP_AUTODETECTION_METHOD  # DaemonSet中添加该环境变量<br>      value: interface=eth0    # 指定内网网卡<br>    - name: WAIT_FOR_DATASTORE<br>      value: &quot;true&quot;<br>......<br><span class="hljs-meta">#</span><span class="bash"> kubectl apply -f calico.yaml  <span class="hljs-comment"># 安装calico网络插件</span></span><br></code></pre></td></tr></table></figure>
<p>等待一段时间可以查看下<code>pod</code>的状态</p>
<h4 id="2、查看pod状态"><a href="#2、查看pod状态" class="headerlink" title="2、查看pod状态"></a>2、查看<code>pod</code>状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl get pods -n kube-system</span><br>NAME                                       READY   STATUS    RESTARTS   AGE<br>calico-kube-controllers-65b8787765-hx9cr   1/1     Running   0          3h50m<br>calico-node-2rlsz                          1/1     Running   0          3h18m<br>calico-node-5vz46                          1/1     Running   0          3h50m<br>calico-node-6szsd                          1/1     Running   0          3h50m<br>calico-node-s5nmr                          1/1     Running   0          3h29m<br>coredns-bccdc95cf-9jf8w                    1/1     Running   0          4h8m<br>coredns-bccdc95cf-gk27l                    1/1     Running   0          4h8m<br>etcd-k8s-master                            1/1     Running   0          4h7m<br>kube-apiserver-k8s-master                  1/1     Running   0          4h7m<br>kube-controller-manager-k8s-master         1/1     Running   0          4h7m<br>kube-proxy-5jbft                           1/1     Running   0          3h29m<br>kube-proxy-d9p8w                           1/1     Running   0          3h18m<br>kube-proxy-h6n88                           1/1     Running   0          3h54m<br>kube-proxy-mqgj7                           1/1     Running   0          4h8m<br>kube-scheduler-k8s-master                  1/1     Running   0          4h7m<br></code></pre></td></tr></table></figure>
<p>网络插件运行成功了，node 状态也正常了：</p>
<h4 id="3、查看node状态"><a href="#3、查看node状态" class="headerlink" title="3、查看node状态"></a>3、查看<code>node</code>状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl get nodes</span><br>NAME         STATUS   ROLES    AGE     VERSION<br>k8s-master   Ready    master   4h10m   v1.15.3<br>k8s-node1    Ready    &lt;none&gt;   3h55m   v1.15.3<br>k8s-node2    Ready    &lt;none&gt;   3h31m   v1.15.3<br>k8s-node3    Ready    &lt;none&gt;   3h20m   v1.15.3<br></code></pre></td></tr></table></figure>
<h4 id="4、安装calicoctl"><a href="#4、安装calicoctl" class="headerlink" title="4、安装calicoctl"></a>4、安装calicoctl</h4><p>将<code>calicoctl</code>安装为<code>Kubernetes pod</code><br>使用<code>Kubernetes API</code>数据存储区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calicoctl.yaml</span><br></code></pre></td></tr></table></figure>
<p>然后，您可以使用kubectl运行命令，如下所示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl <span class="hljs-built_in">exec</span> -ti -n kube-system calicoctl -- /calicoctl get profiles -o wide</span><br>NAME                                                 LABELS   <br>kns.default                                          map[]    <br>kns.kube-node-lease                                  map[]    <br>kns.kube-public                                      map[]    <br>kns.kube-system                                      map[]    <br>ksa.default.default                                  map[]    <br>ksa.kube-node-lease.default                          map[]    <br>ksa.kube-public.default                              map[]    <br>ksa.kube-system.attachdetach-controller              map[]    <br>ksa.kube-system.bootstrap-signer                     map[]    <br>ksa.kube-system.calico-kube-controllers              map[]    <br>ksa.kube-system.calico-node                          map[]    <br>ksa.kube-system.calicoctl                            map[]    <br>ksa.kube-system.certificate-controller               map[]    <br>ksa.kube-system.clusterrole-aggregation-controller   map[]    <br>ksa.kube-system.coredns                              map[]    <br>ksa.kube-system.cronjob-controller                   map[]    <br>ksa.kube-system.daemon-set-controller                map[]    <br>ksa.kube-system.default                              map[]    <br>ksa.kube-system.deployment-controller                map[]    <br>ksa.kube-system.disruption-controller                map[]    <br>ksa.kube-system.endpoint-controller                  map[]    <br>ksa.kube-system.expand-controller                    map[]    <br>ksa.kube-system.generic-garbage-collector            map[]    <br>ksa.kube-system.horizontal-pod-autoscaler            map[]    <br>ksa.kube-system.job-controller                       map[]    <br>ksa.kube-system.kube-proxy                           map[]    <br>ksa.kube-system.namespace-controller                 map[]    <br>ksa.kube-system.node-controller                      map[]    <br>ksa.kube-system.persistent-volume-binder             map[]    <br>ksa.kube-system.pod-garbage-collector                map[]    <br>ksa.kube-system.pv-protection-controller             map[]    <br>ksa.kube-system.pvc-protection-controller            map[]    <br>ksa.kube-system.replicaset-controller                map[]    <br>ksa.kube-system.replication-controller               map[]    <br>ksa.kube-system.resourcequota-controller             map[]    <br>ksa.kube-system.service-account-controller           map[]    <br>ksa.kube-system.service-controller                   map[]    <br>ksa.kube-system.statefulset-controller               map[]    <br>ksa.kube-system.token-cleaner                        map[]    <br>ksa.kube-system.ttl-controller                       map[]    <br></code></pre></td></tr></table></figure>
<h4 id="5、设置别名"><a href="#5、设置别名" class="headerlink" title="5、设置别名"></a>5、设置别名</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">alias</span> calicoctl=<span class="hljs-string">&quot;kubectl exec -i -n kube-system calicoctl /calicoctl -- &quot;</span></span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;alias calicoctl=&quot;kubectl exec -i -n kube-system calicoctl /calicoctl -- &quot;&#x27;</span> &gt;&gt; .bashrc</span> <br><span class="hljs-meta">#</span><span class="bash"> tail -n 1 .bashrc</span> <br>alias calicoctl=&quot;kubectl exec -i -n kube-system calicoctl /calicoctl -- &quot;<br></code></pre></td></tr></table></figure>
<h4 id="6、使命别名执行命令"><a href="#6、使命别名执行命令" class="headerlink" title="6、使命别名执行命令"></a>6、使命别名执行命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> calicoctl get nodes</span><br>NAME         <br>k8s-master   <br>k8s-node1    <br>k8s-node2    <br>k8s-node3    <br></code></pre></td></tr></table></figure>
<h4 id="7、测试coredns"><a href="#7、测试coredns" class="headerlink" title="7、测试coredns"></a>7、测试coredns</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl run curl --image=radial/busyboxplus:curl -it</span> <br>kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.<br>If you don&#x27;t see a command prompt, try pressing enter.<br>[ root@curl-6bf6db5c4f-dqw9x:/ ]$ nslookup kubernetes.default<br>Server:    10.96.0.10<br>Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local<br><br>Name:      kubernetes.default<br>Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local<br>[ root@curl-6bf6db5c4f-dqw9x:/ ]$ <br></code></pre></td></tr></table></figure>
<h3 id="安装Dashboard"><a href="#安装Dashboard" class="headerlink" title="安装Dashboard"></a>安装Dashboard</h3><h4 id="1、下载kubernetes-dashboard-yaml文件"><a href="#1、下载kubernetes-dashboard-yaml文件" class="headerlink" title="1、下载kubernetes-dashboard.yaml文件"></a>1、下载<code>kubernetes-dashboard.yaml</code>文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br></code></pre></td></tr></table></figure>
<h4 id="2、科学上网"><a href="#2、科学上网" class="headerlink" title="2、科学上网"></a>2、科学上网</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> vim kubernetes-dashboard.yaml</span><br><span class="hljs-meta">#</span><span class="bash"> 修改镜像名称</span><br>......<br>containers:<br>- args:<br>  - --auto-generate-certificates<br>  image: registry.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1   # 修改成阿里源<br>  imagePullPolicy: IfNotPresent<br>......<br><span class="hljs-meta">#</span><span class="bash"> 修改Service为NodePort类型</span><br>......<br>selector:<br>  k8s-app: kubernetes-dashboard<br>type: NodePort<br>......<br></code></pre></td></tr></table></figure>
<h4 id="3、安装Dashboard"><a href="#3、安装Dashboard" class="headerlink" title="3、安装Dashboard"></a>3、安装<code>Dashboard</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl apply -f kubernetes-dashboard.yaml</span><br><span class="hljs-meta">#</span><span class="bash"> kubectl get pods -n kube-system -l k8s-app=kubernetes-dashboard</span><br>NAME                                    READY   STATUS    RESTARTS   AGE<br>kubernetes-dashboard-5dc4c54b55-c7sv2   1/1     Running   0          62s<br>[root@k8s-master ~]# kubectl get pods,svc -n kube-system -l k8s-app=kubernetes-dashboard<br>NAME                                        READY   STATUS    RESTARTS   AGE<br>pod/kubernetes-dashboard-5dc4c54b55-c7sv2   1/1     Running   0          81s<br><br>NAME                           TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE<br>service/kubernetes-dashboard   NodePort   10.107.132.165   &lt;none&gt;        443:30114/TCP   80s<br></code></pre></td></tr></table></figure>
<h4 id="4、创建一个具有全局所有权限的用户来登录Dashboard"><a href="#4、创建一个具有全局所有权限的用户来登录Dashboard" class="headerlink" title="4、创建一个具有全局所有权限的用户来登录Dashboard"></a>4、创建一个具有全局所有权限的用户来登录<code>Dashboard</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> vim rbac.yml</span><br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: admin-user<br>  namespace: kube-system<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: admin-user<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: cluster-admin<br>subjects:<br>- kind: ServiceAccount<br>  name: admin-user<br>  namespace: kube-system<br></code></pre></td></tr></table></figure>
<p>直接创建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl apply -f rbac.yml</span><br><span class="hljs-meta">#</span><span class="bash"> kubectl get secret -n kube-system|grep admin</span><br>admin-user-token-wpqck                           kubernetes.io/service-account-token   3      2m38s<br></code></pre></td></tr></table></figure>
<h4 id="6、获取登录token"><a href="#6、获取登录token" class="headerlink" title="6、获取登录token"></a>6、获取登录<code>token</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)|grep token:</span><br>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXdwcWNrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwZmUzNTRiYS1mODkxLTQ0M2UtOWUxMy0wNjE3NWEzNWI5NzMiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.Xqq3V8MmFp5ssCw4Hhzxy9YmdiVxMLsMSXnMaklOkVjHiX4B4kVGED2IDmwTh3wEi2VqYxjkRVm-b_JY2AmCfoaPMUtb4R9OZj414volWgAH1CX4VbFB0o1yr6aP3i8SKmQlQfIweEqYUWDGB5zv3ml1u0WjUGyVJeiXY0GxDAtiROelsKaK4gHGsUlIFZ8izW0xmuGDnT9hvCuztqbGsb78bFmQfAL2dKNB12rLOg01EwF0g88jvtfHiv80yX18ulP46ZK0MFx4YhTrLRjq09rAqCSnMGWPHtBSogKUQhpDkwCze61ByKlG6KM_DhFE7elQkBEj-jwvygDwvn7tMQ<br></code></pre></td></tr></table></figure>
<h4 id="7、使用Firefox浏览器登录Dashboard"><a href="#7、使用Firefox浏览器登录Dashboard" class="headerlink" title="7、使用Firefox浏览器登录Dashboard"></a>7、使用<code>Firefox</code>浏览器登录<code>Dashboard</code></h4><p><img src="https://ljw.howieli.cn/blog/2019-9-1/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190830152421.png" srcset="/img/loading.gif"></p>
<p><img src="https://ljw.howieli.cn/blog/2019-9-1/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190830152716.png" srcset="/img/loading.gif"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/kubernetes/">kubernetes</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/kubernetes/">kubernetes</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/%E5%9C%A8k8s%E4%B8%8A%E9%83%A8%E7%BD%B2ingress-nginx%E5%B9%B6%E4%BD%BF%E7%94%A8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">在k8s上部署ingress-nginx并使用</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/harbor%E6%90%AD%E5%BB%BA/">
                        <span class="hidden-mobile">harbor搭建</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
