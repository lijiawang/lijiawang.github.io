<article id="post-openstack instance vm_power_state 状态置为 NOSTATE" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 class="article-title" itemprop="name">
      openstack instance vm_power_state 状态置为 NOSTATE
    </h1>
  


  
  
  
  
    
<div style="margin-top:10px;">
  <span class="post-time">
    <span class="post-meta-item-icon">
      <!-- fonts.scss -->
      <!-- 百度字体平台:http://fontstore.baidu.com/static/editor/index.html -->
      <i class="icon-statistics"></i>
      <span class="post-meta-item-text"> 字数统计:</span>
      <span class="post-count">2.1k字</span>
    </span>
  </span>

  <span class="post-time">
    &nbsp; | &nbsp;
    <span class="post-meta-item-icon">
      <i class="icon-book icon"></i>
      <span class="post-meta-item-text"> 阅读时长≈</span>
      <span class="post-count">12分</span>
    </span>
  </span>
</div>


  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h3 id="openstack-上的instance运行正常，但是power-state状态为NOSTATE，导致instance热迁移失败"><a href="#openstack-上的instance运行正常，但是power-state状态为NOSTATE，导致instance热迁移失败" class="headerlink" title="openstack 上的instance运行正常，但是power_state状态为NOSTATE，导致instance热迁移失败"></a>openstack 上的instance运行正常，但是power_state状态为NOSTATE，导致instance热迁移失败</h3><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>1、再一次热迁移时候发现迁移时候报以下错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># openstack server migrate --live node-53 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">Cannot &apos;os-migrateLive&apos; instance 86487ef4-cc12-4be6-995e-46f5ac093901 while it is in power_state 0 (HTTP 409) (Request-ID: req-6c14e0ee-c3df-42de-873d-9ecc8ad215cc)</div></pre></td></tr></table></figure></p>
<p>2、查看实例，发现虚拟机运行正常，但是 power_state 为 NOSTATE<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"># openstack server show 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| Field                               | Value                                                          |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | m_cpu+san                                                      |</div><div class="line">| OS-EXT-SRV-ATTR:host                | node-27                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | node-27                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-000071aa                                              |</div><div class="line">| OS-EXT-STS:power_state              | NOSTATE                                                        |</div><div class="line">| OS-EXT-STS:task_state               | None                                                           |</div><div class="line">| OS-EXT-STS:vm_state                 | active                                                         |</div><div class="line">| OS-SRV-USG:launched_at              | 2018-09-21T05:40:36.000000                                     |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                                           |</div><div class="line">| accessIPv4                          |                                                                |</div><div class="line">| accessIPv6                          |                                                                |</div><div class="line">| addresses                           | vlan_10.122.44.0/23=10.122.45.53                               |</div><div class="line">| config_drive                        | True                                                           |</div><div class="line">| created                             | 2018-09-21T05:40:31Z                                           |</div><div class="line">| flavor                              | 16-64-100 (1cbe4ea1-8a67-4027-afd4-8f31a8b94851)               |</div><div class="line">| hostId                              | 2730fa3d62e347ddb67e155f6eed973787a868c82316f7e6ba641b10       |</div><div class="line">| id                                  | 86487ef4-cc12-4be6-995e-46f5ac093901                           |</div><div class="line">| image                               | lenovo-centos-7-release (b9f8f864-4217-4ac6-a116-62ecfa0fc074) |</div><div class="line">| key_name                            | None                                                           |</div><div class="line">| name                                | SLP3YM7HRCX                                                    |</div><div class="line">| progress                            | 100                                                            |</div><div class="line">| project_id                          | e992715df18a417997c068e5f9834b0f                               |</div><div class="line">| properties                          |                                                                |</div><div class="line">| security_groups                     | name=&apos;default&apos;                                                 |</div><div class="line">| status                              | ACTIVE                                                         |</div><div class="line">| updated                             | 2019-10-09T07:58:58Z                                           |</div><div class="line">| user_id                             | af518aeb935c4d258f8cb7d302c83797                               |</div><div class="line">| volumes_attached                    | id=&apos;a821856b-409f-4e6e-becd-eb4b2344c7d8&apos;                      |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="查找原因"><a href="#查找原因" class="headerlink" title="查找原因"></a>查找原因</h3><p>列出该虚拟机的历史操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># nova instance-action-list 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+----------------+------------------------------------------+---------+----------------------------+</div><div class="line">| Action         | Request_ID                               | Message | Start_Time                 |</div><div class="line">+----------------+------------------------------------------+---------+----------------------------+</div><div class="line">| create         | req-4d01a466-ce7a-48a9-b575-e129b61bcc30 | -       | 2018-09-21T05:40:30.000000 |</div><div class="line">| live-migration | req-2d93bc73-e43f-4ca6-88fc-a6ad1a4021a6 | -       | 2018-09-21T05:44:47.000000 |</div><div class="line">| live-migration | req-7fcbfb15-7e3c-471d-8ea5-020d438d23c3 | -       | 2019-03-24T13:00:30.000000 |</div><div class="line">| live-migration | req-2b009c4f-caef-4d90-81fd-d480c1b9efad | Error   | 2019-10-09T07:00:13.000000 |</div><div class="line">| live-migration | req-b364724b-6b28-4d5f-8f14-05d1c4abeceb | Error   | 2019-10-09T07:07:37.000000 |</div><div class="line">| live-migration | req-8669d3b1-e57e-4b35-8d40-a110b64f47c8 | Error   | 2019-10-09T07:29:13.000000 |</div><div class="line">| live-migration | req-ecec98ca-3777-4ca3-afcd-83e36381e038 | Error   | 2019-10-09T07:55:12.000000 |</div><div class="line">| live-migration | req-6378f839-89c0-43c0-8a65-40e5b775283c | Error   | 2019-10-09T07:58:14.000000 |</div><div class="line">| live-migration | req-e966caa7-06e5-4a29-a371-517d98c37121 | Error   | 2019-10-09T07:58:58.000000 |</div><div class="line">| live-migration | req-6c14e0ee-c3df-42de-873d-9ecc8ad215cc | Error   | 2019-10-09T08:31:47.000000 |</div><div class="line">+----------------+------------------------------------------+---------+----------------------------+</div></pre></td></tr></table></figure></p>
<p>列出该实例的迁移记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line"># nova  migration-list|grep 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">| 84892 | -           | -         | node-27        | node-29            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:07:37.000000 | 2019-10-09T07:07:37.000000 | live-migration |</div><div class="line">| 54307 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-03-24T13:00:30.000000 | 2019-03-24T17:10:10.000000 | live-migration |</div><div class="line">| 84904 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:29:13.000000 | 2019-10-09T07:29:13.000000 | live-migration |</div><div class="line">| 84913 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:55:12.000000 | 2019-10-09T07:55:12.000000 | live-migration |</div><div class="line">| 84919 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:58:14.000000 | 2019-10-09T07:58:14.000000 | live-migration |</div><div class="line">| 84922 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:58:58.000000 | 2019-10-09T07:58:58.000000 | live-migration |</div><div class="line">| 84931 | -           | -         | node-27        | node-53            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T08:31:47.000000 | 2019-10-09T08:31:47.000000 | live-migration |</div><div class="line">| 84889 | -           | -         | node-27        | node-89            | -            | error         | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2019-10-09T07:00:13.000000 | 2019-10-09T07:00:13.000000 | live-migration |</div><div class="line">| 42241 | -           | -         | node-33        | node-27            | -            | completed     | 86487ef4-cc12-4be6-995e-46f5ac093901 | 189        | 189        | 2018-09-21T05:44:48.000000 | 2018-09-21T05:45:13.000000 | live-migration |</div><div class="line">可以看到该实例从node-27节点迁移到node-85、node-53、node-29节点均为迁移成功</div><div class="line">查看instance所在的节点</div><div class="line"># ssh node-27</div><div class="line"></div><div class="line">root@node-27:~# virsh list --all|grep instance-000071aa </div><div class="line">root@node-27:~# exit</div><div class="line">logout</div><div class="line">Connection to node-27 closed.</div><div class="line"># ssh node-53</div><div class="line"></div><div class="line">root@node-53:~#  virsh list --all|grep instance-000071aa</div><div class="line"> 91    instance-000071aa              running</div><div class="line">root@node-53:~# exit</div><div class="line">logout</div><div class="line">Connection to node-53 closed.</div><div class="line"># openstack server show 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| Field                               | Value                                                          |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | m_cpu+san                                                      |</div><div class="line">| OS-EXT-SRV-ATTR:host                | node-27                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | node-27                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-000071aa                                              |</div><div class="line">| OS-EXT-STS:power_state              | NOSTATE                                                        |</div><div class="line">| OS-EXT-STS:task_state               | None                                                           |</div><div class="line">| OS-EXT-STS:vm_state                 | active                                                         |</div><div class="line">| OS-SRV-USG:launched_at              | 2018-09-21T05:40:36.000000                                     |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                                           |</div><div class="line">| accessIPv4                          |                                                                |</div><div class="line">| accessIPv6                          |                                                                |</div><div class="line">| addresses                           | vlan_10.122.44.0/23=10.122.45.53                               |</div><div class="line">| config_drive                        | True                                                           |</div><div class="line">| created                             | 2018-09-21T05:40:31Z                                           |</div><div class="line">| flavor                              | 16-64-100 (1cbe4ea1-8a67-4027-afd4-8f31a8b94851)               |</div><div class="line">| hostId                              | 2730fa3d62e347ddb67e155f6eed973787a868c82316f7e6ba641b10       |</div><div class="line">| id                                  | 86487ef4-cc12-4be6-995e-46f5ac093901                           |</div><div class="line">| image                               | lenovo-centos-7-release (b9f8f864-4217-4ac6-a116-62ecfa0fc074) |</div><div class="line">| key_name                            | None                                                           |</div><div class="line">| name                                | SLP3YM7HRCX                                                    |</div><div class="line">| progress                            | 100                                                            |</div><div class="line">| project_id                          | e992715df18a417997c068e5f9834b0f                               |</div><div class="line">| properties                          |                                                                |</div><div class="line">| security_groups                     | name=&apos;default&apos;                                                 |</div><div class="line">| status                              | ACTIVE                                                         |</div><div class="line">| updated                             | 2019-10-09T08:31:47Z                                           |</div><div class="line">| user_id                             | af518aeb935c4d258f8cb7d302c83797                               |</div><div class="line">| volumes_attached                    | id=&apos;a821856b-409f-4e6e-becd-eb4b2344c7d8&apos;                      |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">root@node-1:~# mysql -unova -pnova</div><div class="line">MariaDB [(none)]&gt; select * from nova.instances where uuid=&apos;86487ef4-cc12-4be6-995e-46f5ac093901&apos;\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">              created_at: 2018-09-21 05:40:31</div><div class="line">              updated_at: 2019-10-09 08:31:47</div><div class="line">              deleted_at: NULL</div><div class="line">                      id: 29098</div><div class="line">             internal_id: NULL</div><div class="line">                 user_id: af518aeb935c4d258f8cb7d302c83797</div><div class="line">              project_id: e992715df18a417997c068e5f9834b0f</div><div class="line">               image_ref: b9f8f864-4217-4ac6-a116-62ecfa0fc074</div><div class="line">               kernel_id: </div><div class="line">              ramdisk_id: </div><div class="line">            launch_index: 0</div><div class="line">                key_name: NULL</div><div class="line">                key_data: NULL</div><div class="line">             power_state: 0</div><div class="line">                vm_state: active</div><div class="line">               memory_mb: 65536</div><div class="line">                   vcpus: 16</div><div class="line">                hostname: slp3ym7hrcx</div><div class="line">                    host: node-27</div><div class="line">               user_data: NULL</div><div class="line">          reservation_id: r-o8dr8ibn</div><div class="line">             launched_at: 2018-09-21 05:40:36</div><div class="line">           terminated_at: NULL</div><div class="line">            display_name: SLP3YM7HRCX</div><div class="line">     display_description: SLP3YM7HRCX</div><div class="line">       availability_zone: no_san</div><div class="line">                  locked: 0</div><div class="line">                 os_type: NULL</div><div class="line">             launched_on: node-33</div><div class="line">        instance_type_id: 189</div><div class="line">                 vm_mode: NULL</div><div class="line">                    uuid: 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">            architecture: NULL</div><div class="line">        root_device_name: /dev/vda</div><div class="line">            access_ip_v4: NULL</div><div class="line">            access_ip_v6: NULL</div><div class="line">            config_drive: True</div><div class="line">              task_state: NULL</div><div class="line">default_ephemeral_device: NULL</div><div class="line">     default_swap_device: NULL</div><div class="line">                progress: 100</div><div class="line">        auto_disk_config: 0</div><div class="line">      shutdown_terminate: 0</div><div class="line">       disable_terminate: 0</div><div class="line">                 root_gb: 100</div><div class="line">            ephemeral_gb: 0</div><div class="line">               cell_name: NULL</div><div class="line">                    node: node-27</div><div class="line">                 deleted: 0</div><div class="line">               locked_by: NULL</div><div class="line">                 cleaned: 1</div><div class="line">      ephemeral_key_uuid: NULL</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">ERROR: No query specified</div></pre></td></tr></table></figure></p>
<p>发现实际instance启动在node-53节点上，但是数据库记录在node-27节点上</p>
<p>manager.py 捕获到 InstanceNotFound 设置 vm_power_state=NOSTATE<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/usr/lib/python2<span class="number">.7</span>/dist-packages/nova/compute/manager.py</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_query_driver_power_state_and_sync</span><span class="params">(self, context, db_instance)</span>:</span></div><div class="line">        <span class="keyword">if</span> db_instance.task_state <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            LOG.info(_LI(<span class="string">"During sync_power_state the instance has a "</span></div><div class="line">                         <span class="string">"pending task (%(task)s). Skip."</span>),</div><div class="line">                     &#123;<span class="string">'task'</span>: db_instance.task_state&#125;, instance=db_instance)</div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="comment"># No pending tasks. Now try to figure out the real vm_power_state.</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            vm_instance = self.driver.get_info(db_instance)</div><div class="line">            vm_power_state = vm_instance.state</div><div class="line">        <span class="keyword">except</span> exception.InstanceNotFound:         <span class="comment"># 可以看到如果InstanceNotFound</span></div><div class="line">            vm_power_state = power_state.NOSTATE   <span class="comment"># power_state设置为NOSTATE</span></div><div class="line">        <span class="comment"># Note(maoy): the above get_info call might take a long time,</span></div><div class="line">        <span class="comment"># for example, because of a broken libvirt driver.</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self._sync_instance_power_state(context,</div><div class="line">                                            db_instance,</div><div class="line">                                            vm_power_state,</div><div class="line">                                            use_slave=<span class="keyword">True</span>)</div><div class="line">        <span class="keyword">except</span> exception.InstanceNotFound:</div><div class="line">            <span class="comment"># NOTE(hanlind): If the instance gets deleted during sync,</span></div><div class="line">            <span class="comment"># silently ignore.</span></div><div class="line">            <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<h3 id="得到原因"><a href="#得到原因" class="headerlink" title="得到原因"></a>得到原因</h3><p>由于之前 migrate ERROR 导致 instance 实际启动的节点和数据库记录的节点不一致，comoute 通过 manager.py 捕获到 InstanceNotFound， 所以把 vm_power_state 状态置为 NOSTATE</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>更新数据库，将数据库中的instance对应的host、node更新成实际instance启动的节点信息。硬重启虚拟机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div></pre></td><td class="code"><pre><div class="line">root@node-1:~# mysql -unova -pnova</div><div class="line">MariaDB [(none)]&gt; update nova.instances set host=&apos;node-53&apos; where uuid=&apos;86487ef4-cc12-4be6-995e-46f5ac093901&apos;\G;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div><div class="line"></div><div class="line">ERROR: No query specified</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; update nova.instances set node=&apos;node-53&apos; where uuid=&apos;86487ef4-cc12-4be6-995e-46f5ac093901&apos;\G;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div><div class="line"></div><div class="line">ERROR: No query specified</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; select * from nova.instances where uuid=&apos;86487ef4-cc12-4be6-995e-46f5ac093901&apos;\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">              created_at: 2018-09-21 05:40:31</div><div class="line">              updated_at: 2019-10-09 08:31:47</div><div class="line">              deleted_at: NULL</div><div class="line">                      id: 29098</div><div class="line">             internal_id: NULL</div><div class="line">                 user_id: af518aeb935c4d258f8cb7d302c83797</div><div class="line">              project_id: e992715df18a417997c068e5f9834b0f</div><div class="line">               image_ref: b9f8f864-4217-4ac6-a116-62ecfa0fc074</div><div class="line">               kernel_id: </div><div class="line">              ramdisk_id: </div><div class="line">            launch_index: 0</div><div class="line">                key_name: NULL</div><div class="line">                key_data: NULL</div><div class="line">             power_state: 0</div><div class="line">                vm_state: active</div><div class="line">               memory_mb: 65536</div><div class="line">                   vcpus: 16</div><div class="line">                hostname: slp3ym7hrcx</div><div class="line">                    host: node-53</div><div class="line">               user_data: NULL</div><div class="line">          reservation_id: r-o8dr8ibn</div><div class="line">             launched_at: 2018-09-21 05:40:36</div><div class="line">           terminated_at: NULL</div><div class="line">            display_name: SLP3YM7HRCX</div><div class="line">     display_description: SLP3YM7HRCX</div><div class="line">       availability_zone: no_san</div><div class="line">                  locked: 0</div><div class="line">                 os_type: NULL</div><div class="line">             launched_on: node-33</div><div class="line">        instance_type_id: 189</div><div class="line">                 vm_mode: NULL</div><div class="line">                    uuid: 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">            architecture: NULL</div><div class="line">        root_device_name: /dev/vda</div><div class="line">            access_ip_v4: NULL</div><div class="line">            access_ip_v6: NULL</div><div class="line">            config_drive: True</div><div class="line">              task_state: NULL</div><div class="line">default_ephemeral_device: NULL</div><div class="line">     default_swap_device: NULL</div><div class="line">                progress: 100</div><div class="line">        auto_disk_config: 0</div><div class="line">      shutdown_terminate: 0</div><div class="line">       disable_terminate: 0</div><div class="line">                 root_gb: 100</div><div class="line">            ephemeral_gb: 0</div><div class="line">               cell_name: NULL</div><div class="line">                    node: node-53</div><div class="line">                 deleted: 0</div><div class="line">               locked_by: NULL</div><div class="line">                 cleaned: 1</div><div class="line">      ephemeral_key_uuid: NULL</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">ERROR: No query specified</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; exit</div><div class="line">Bye</div><div class="line"># openstack server show 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| Field                               | Value                                                          |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | no_san                                                         |</div><div class="line">| OS-EXT-SRV-ATTR:host                | node-53                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | node-53                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-000071aa                                              |</div><div class="line">| OS-EXT-STS:power_state              | NOSTATE                                                        |</div><div class="line">| OS-EXT-STS:task_state               | None                                                           |</div><div class="line">| OS-EXT-STS:vm_state                 | active                                                         |</div><div class="line">| OS-SRV-USG:launched_at              | 2018-09-21T05:40:36.000000                                     |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                                           |</div><div class="line">| accessIPv4                          |                                                                |</div><div class="line">| accessIPv6                          |                                                                |</div><div class="line">| addresses                           | vlan_10.122.44.0/23=10.122.45.53                               |</div><div class="line">| config_drive                        | True                                                           |</div><div class="line">| created                             | 2018-09-21T05:40:31Z                                           |</div><div class="line">| flavor                              | 16-64-100 (1cbe4ea1-8a67-4027-afd4-8f31a8b94851)               |</div><div class="line">| hostId                              | f5274ebe433297bc376a4ce09151591735a04d2b6762280866de2729       |</div><div class="line">| id                                  | 86487ef4-cc12-4be6-995e-46f5ac093901                           |</div><div class="line">| image                               | lenovo-centos-7-release (b9f8f864-4217-4ac6-a116-62ecfa0fc074) |</div><div class="line">| key_name                            | None                                                           |</div><div class="line">| name                                | SLP3YM7HRCX                                                    |</div><div class="line">| progress                            | 100                                                            |</div><div class="line">| project_id                          | e992715df18a417997c068e5f9834b0f                               |</div><div class="line">| properties                          |                                                                |</div><div class="line">| security_groups                     | name=&apos;default&apos;                                                 |</div><div class="line">| status                              | ACTIVE                                                         |</div><div class="line">| updated                             | 2019-10-09T08:31:47Z                                           |</div><div class="line">| user_id                             | af518aeb935c4d258f8cb7d302c83797                               |</div><div class="line">| volumes_attached                    | id=&apos;a821856b-409f-4e6e-becd-eb4b2344c7d8&apos;                      |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># nova reboot --hard 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line"></div><div class="line"># openstack  server show 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| Field                               | Value                                                          |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | no_san                                                         |</div><div class="line">| OS-EXT-SRV-ATTR:host                | node-53                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | node-53                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-000071aa                                              |</div><div class="line">| OS-EXT-STS:power_state              | Running                                                        |</div><div class="line">| OS-EXT-STS:task_state               | None                                                           |</div><div class="line">| OS-EXT-STS:vm_state                 | active                                                         |</div><div class="line">| OS-SRV-USG:launched_at              | 2018-09-21T05:40:36.000000                                     |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                                           |</div><div class="line">| accessIPv4                          |                                                                |</div><div class="line">| accessIPv6                          |                                                                |</div><div class="line">| addresses                           | vlan_10.122.44.0/23=10.122.45.53                               |</div><div class="line">| config_drive                        | True                                                           |</div><div class="line">| created                             | 2018-09-21T05:40:31Z                                           |</div><div class="line">| flavor                              | 16-64-100 (1cbe4ea1-8a67-4027-afd4-8f31a8b94851)               |</div><div class="line">| hostId                              | 4bfe001f6fa4d443f283121b56139ef8bfbff47be8106387cc19edc6       |</div><div class="line">| id                                  | 86487ef4-cc12-4be6-995e-46f5ac093901                           |</div><div class="line">| image                               | lenovo-centos-7-release (b9f8f864-4217-4ac6-a116-62ecfa0fc074) |</div><div class="line">| key_name                            | None                                                           |</div><div class="line">| name                                | SLP3YM7HRCX                                                    |</div><div class="line">| progress                            | 0                                                              |</div><div class="line">| project_id                          | e992715df18a417997c068e5f9834b0f                               |</div><div class="line">| properties                          |                                                                |</div><div class="line">| security_groups                     | name=&apos;default&apos;                                                 |</div><div class="line">| status                              | ACTIVE                                                         |</div><div class="line">| updated                             | 2019-10-09T10:04:19Z                                           |</div><div class="line">| user_id                             | af518aeb935c4d258f8cb7d302c83797                               |</div><div class="line">| volumes_attached                    | id=&apos;a821856b-409f-4e6e-becd-eb4b2344c7d8&apos;                      |</div><div class="line">|                                     | id=&apos;ff7d2dad-1954-4906-ae18-95c76a09b442&apos;                      |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line"></div><div class="line"># openstack server migrate --live node-89 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line"></div><div class="line"># openstack  server show 86487ef4-cc12-4be6-995e-46f5ac093901</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| Field                               | Value                                                          |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div><div class="line">| OS-DCF:diskConfig                   | MANUAL                                                         |</div><div class="line">| OS-EXT-AZ:availability_zone         | Contingency                                                    |</div><div class="line">| OS-EXT-SRV-ATTR:host                | node-89                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | node-89                                                        |</div><div class="line">| OS-EXT-SRV-ATTR:instance_name       | instance-000071aa                                              |</div><div class="line">| OS-EXT-STS:power_state              | Running                                                        |</div><div class="line">| OS-EXT-STS:task_state               | None                                                           |</div><div class="line">| OS-EXT-STS:vm_state                 | active                                                         |</div><div class="line">| OS-SRV-USG:launched_at              | 2018-09-21T05:40:36.000000                                     |</div><div class="line">| OS-SRV-USG:terminated_at            | None                                                           |</div><div class="line">| accessIPv4                          |                                                                |</div><div class="line">| accessIPv6                          |                                                                |</div><div class="line">| addresses                           | vlan_10.122.44.0/23=10.122.45.53                               |</div><div class="line">| config_drive                        | True                                                           |</div><div class="line">| created                             | 2018-09-21T05:40:31Z                                           |</div><div class="line">| flavor                              | 16-64-100 (1cbe4ea1-8a67-4027-afd4-8f31a8b94851)               |</div><div class="line">| hostId                              | 4bfe001f6fa4d443f283121b56139ef8bfbff47be8106387cc19edc6       |</div><div class="line">| id                                  | 86487ef4-cc12-4be6-995e-46f5ac093901                           |</div><div class="line">| image                               | lenovo-centos-7-release (b9f8f864-4217-4ac6-a116-62ecfa0fc074) |</div><div class="line">| key_name                            | None                                                           |</div><div class="line">| name                                | SLP3YM7HRCX                                                    |</div><div class="line">| progress                            | 0                                                              |</div><div class="line">| project_id                          | e992715df18a417997c068e5f9834b0f                               |</div><div class="line">| properties                          |                                                                |</div><div class="line">| security_groups                     | name=&apos;default&apos;                                                 |</div><div class="line">| status                              | ACTIVE                                                         |</div><div class="line">| updated                             | 2019-10-09T10:04:19Z                                           |</div><div class="line">| user_id                             | af518aeb935c4d258f8cb7d302c83797                               |</div><div class="line">| volumes_attached                    | id=&apos;a821856b-409f-4e6e-becd-eb4b2344c7d8&apos;                      |</div><div class="line">|                                     | id=&apos;ff7d2dad-1954-4906-ae18-95c76a09b442&apos;                      |</div><div class="line">+-------------------------------------+----------------------------------------------------------------+</div></pre></td></tr></table></figure></p>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          李家旺
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="https://www.lijiawang.org/posts/openstack instance vm_power_state 状态置为 NOSTATE.html" title="openstack instance vm_power_state 状态置为 NOSTATE" target="_blank">https://www.lijiawang.org/posts/openstack instance vm_power_state 状态置为 NOSTATE.html</a>
        </li>
        <li>
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow" target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
        </li>
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/openstack//" class="article-tag-list-link color5">openstack</a>
        		</li>
      		
		</ul>
	</div>


    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=https://www.lijiawang.org/posts/openstack instance vm_power_state 状态置为 NOSTATE.html" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
  
    <a href="/posts/kubeadm升级k8s集群(v1.15.3 to v1.16.0版).html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">使用kubeadm升级kubernetes集群</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>













